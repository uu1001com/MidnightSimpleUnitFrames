--[[Perfy has instrumented this file]] local Perfy_GetTime, Perfy_Trace, Perfy_Trace_Passthrough = Perfy_GetTime, Perfy_Trace, Perfy_Trace_Passthrough; Perfy_Trace(Perfy_GetTime(), "Enter", "(main chunk) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua"); -- ============================================================================
-- MidnightSimpleUnitFrames - Slash Menu
--
-- Readable Compact Edition (no file split)
--
-- Design goals:
--   - Keep the entire Slash Menu self-contained, but avoid boilerplate spam.
--   - Use UI primitives (UI_Btn/UI_Text/UI_Check) + data-driven rows where possible.
--   - Prefer build-once + refresh-on-show to avoid rebuild regressions.
--
-- Notes:
--   - This file is compact (some statements share lines), but it is NOT minified.
--   - Indentation reflects block structure (if/for/function/repeat).
-- ============================================================================

local addonName,ns=...local function MSUF_LeftJustifyButtonText(btn,leftPad) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_LeftJustifyButtonText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:16:28"); leftPad=leftPad or 10 if not btn or not btn.GetFontString then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_LeftJustifyButtonText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:16:28"); return end
local fs=btn:GetFontString()if not fs then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_LeftJustifyButtonText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:16:28"); return end
if fs.SetJustifyH then fs:SetJustifyH("LEFT")end
if fs.ClearAllPoints and fs.SetPoint then fs:ClearAllPoints();fs:SetPoint("LEFT",btn,"LEFT",leftPad,0)fs:SetPoint("RIGHT",btn,"RIGHT",-8,0)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_LeftJustifyButtonText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:16:28"); end
_G.MSUF_LeftJustifyButtonText=_G.MSUF_LeftJustifyButtonText or MSUF_LeftJustifyButtonText;_G.LeftJustify=_G.LeftJustify or MSUF_LeftJustifyButtonText local MSUF_BuildTools;local MSUF_CapturePanelState;local MSUF_RestorePanelState;local MSUF_SaveWindowGeometry;local MSUF_LoadWindowGeometry;local MSUF_AddTooltip;local MSUF_RegisterEscClose;local MSUF_PickSessionTip;local MSUF_SkinButton;local MSUF_BuildButtonRow local MSUF_BuildButtonRowTL;MSUF_CapturePanelState=MSUF_CapturePanelState or function(panel) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:21:491"); local st={};local sf=panel and(panel.ScrollFrame or panel.scrollFrame or panel.scroll or panel.Scroll or panel.scrollChild)if sf and sf.GetVerticalScroll then st.vScroll=sf:GetVerticalScroll()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:21:491"); return st end
MSUF_RestorePanelState=MSUF_RestorePanelState or function(panel,st) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:23:49"); if not panel or type(st)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:23:49"); return end
local sf=panel.ScrollFrame or panel.scrollFrame or panel.scroll or panel.Scroll or panel.scrollChild if sf and sf.SetVerticalScroll and st.vScroll then pcall(sf.SetVerticalScroll,sf,st.vScroll)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:23:49"); end
local S={win=nil,content=nil,scale={},mirror={host=nil,currentKey="home",currentPanel=nil,homePanel=nil,homeToolsApi=nil,tipText=nil,},}local function MSUF_UpdateHomePanel(panel) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_UpdateHomePanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:26:142"); if not panel then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_UpdateHomePanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:26:142"); return end
local tip=S and S.mirror and S.mirror.tipText if not tip and _G and type(_G.MSUF_GetNextTip)=="function"then tip=_G.MSUF_GetNextTip()if S and S.mirror then S.mirror.tipText=tip end
end
if tip and panel._msufTipText and panel._msufTipText.SetText then panel._msufTipText:SetText(tip)if type(MSUF_ForceItalicFont)=="function"then MSUF_ForceItalicFont(panel._msufTipText)end
if panel._msufTipText.SetAlpha then panel._msufTipText:SetAlpha(0.82)end
end
if S and S.mirror and S.mirror.homeToolsApi and S.mirror.homeToolsApi.Refresh then pcall(S.mirror.homeToolsApi.Refresh)end
local win=_G and _G.MSUF_StandaloneOptionsWindow;local b=win and win._msufDashEditBtn if b and b._msufSetSelected and type(MSUF_IsMSUFEditModeActive)=="function"then b:_msufSetSelected(MSUF_IsMSUFEditModeActive())end
local prof=(_G and _G.MSUF_ActiveProfile)or"Default"if panel._msufProfileValue and panel._msufProfileValue.SetText then panel._msufProfileValue:SetText(prof)end
if panel._msufStatusLine and panel._msufStatusLine.SetText then local edit=(type(MSUF_IsMSUFEditModeActive)=="function"and MSUF_IsMSUFEditModeActive())and"On"or"Off";local combat=(InCombatLockdown and InCombatLockdown())and"In combat"or"Out of combat"panel._msufStatusLine:SetText("Profile: "..tostring(prof).."   •   Edit Mode: "..edit.."   •   "..combat)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_UpdateHomePanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:26:142"); end
local function MSUF_Print(msg) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Print file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:37:6"); if type(print)=="function"then print("|cff00ff00MSUF:|r "..tostring(msg))end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Print file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:37:6"); end
local function clamp(v,lo,hi) Perfy_Trace(Perfy_GetTime(), "Enter", "clamp file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:39:6"); if v<lo then Perfy_Trace(Perfy_GetTime(), "Leave", "clamp file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:39:6"); return lo end
if v>hi then Perfy_Trace(Perfy_GetTime(), "Leave", "clamp file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:39:6"); return hi end
Perfy_Trace(Perfy_GetTime(), "Leave", "clamp file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:39:6"); return v end
local function MSUF_SafeCall(fn,...) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SafeCall file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:42:6"); if type(fn)~="function"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SafeCall file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:42:6"); return end
local ok,a,b,c,d,e=pcall(fn,...)if ok then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SafeCall file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:42:6"); return a,b,c,d,e end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SafeCall file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:42:6"); end
local function MSUF_RefreshApi(api) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_RefreshApi file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:45:6"); if api and api.Refresh then return Perfy_Trace_Passthrough("Leave", "MSUF_RefreshApi file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:45:6", api.Refresh()) end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_RefreshApi file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:45:6"); end
local function MSUF_SetEnabled(w,enabled) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:47:6"); if not w then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:47:6"); return end
if w.SetEnabled then w:SetEnabled(enabled and true or false); Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:47:6"); return end
if enabled then if w.Enable then w:Enable()end
if w.SetAlpha then w:SetAlpha(1.0)end
else if w.Disable then w:Disable()end
    if w.SetAlpha then w:SetAlpha(0.55)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:47:6"); end
local function UI_Button(parent,text,w,h,a1,rel,a2,x,y,onClick,template) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_Button file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:55:6"); local b=CreateFrame("Button",nil,parent,template or"UIPanelButtonTemplate")if w and h then b:SetSize(w,h)end
if a1 then b:SetPoint(a1,rel or parent,a2 or a1,x or 0,y or 0)end
if text~=nil and b.SetText then b:SetText(text)end
if type(MSUF_SkinButton)=="function"then MSUF_SkinButton(b)end
if onClick then b:SetScript("OnClick",onClick)end
Perfy_Trace(Perfy_GetTime(), "Leave", "UI_Button file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:55:6"); return b end
local function UI_CloseButton(parent,a1,rel,a2,x,y,onClick) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_CloseButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:61:6"); local b=CreateFrame("Button",nil,parent,"UIPanelCloseButton")if a1 then b:SetPoint(a1,rel or parent,a2 or a1,x or 0,y or 0)end
if onClick then b:SetScript("OnClick",onClick)end
Perfy_Trace(Perfy_GetTime(), "Leave", "UI_CloseButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:61:6"); return b end
local function UI_Btn(parent,text,w,h,a1,rel,a2,x,y,onClick,tipTitle,tipBody,skinFn,template) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_Btn file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:64:6"); local b=UI_Button(parent,text,w,h,a1,rel,a2,x,y,onClick,template)if skinFn then skinFn(b)end
if MSUF_AddTooltip and tipTitle then MSUF_AddTooltip(b,tipTitle,tipBody)end
Perfy_Trace(Perfy_GetTime(), "Leave", "UI_Btn file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:64:6"); return b end
local function UI_Text(parent,font,a1,rel,a2,x,y,txt,skinFn) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_Text file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:67:6"); local fs=parent:CreateFontString(nil,"OVERLAY",font or"GameFontHighlight")if a1 then fs:SetPoint(a1,rel or parent,a2 or a1,x or 0,y or 0)end
if txt~=nil then fs:SetText(txt)end
if skinFn then skinFn(fs)end
Perfy_Trace(Perfy_GetTime(), "Leave", "UI_Text file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:67:6"); return fs end
local function UI_Check(parent,label,a1,rel,a2,x,y,onClick,tipTitle,tipBody,skinFn,template) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_Check file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:71:6"); local cb=CreateFrame("CheckButton",nil,parent,template or"UICheckButtonTemplate")if a1 then cb:SetPoint(a1,rel or parent,a2 or a1,x or 0,y or 0)end
if cb.Text and cb.Text.SetText then cb.Text:SetText(label or"")end
if skinFn and cb.Text then skinFn(cb.Text)end
if onClick then cb:SetScript("OnClick",onClick)end
if MSUF_AddTooltip and tipTitle then MSUF_AddTooltip(cb,tipTitle,tipBody)end
Perfy_Trace(Perfy_GetTime(), "Leave", "UI_Check file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:71:6"); return cb end
local function MSUF_LayoutColumn(parent,startX,startY,defaultRowH,defaultGap) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_LayoutColumn file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:77:6"); local L={parent=parent,x=startX or 12,y=startY or-12,rowH=defaultRowH or 20,gap=defaultGap or 6,}function L:Row(h,gap) Perfy_Trace(Perfy_GetTime(), "Enter", "L:Row file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:77:174"); local x,y=self.x,self.y;self.y=self.y-(h or self.rowH)-(gap or self.gap) Perfy_Trace(Perfy_GetTime(), "Leave", "L:Row file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:77:174"); return x,y end
function L:MoveY(dy) Perfy_Trace(Perfy_GetTime(), "Enter", "L:MoveY file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:78:0"); self.y=self.y+(dy or 0); Perfy_Trace(Perfy_GetTime(), "Leave", "L:MoveY file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:78:0"); return self end
function L:At(dx,dy) Perfy_Trace(Perfy_GetTime(), "Enter", "L:At file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:79:0"); return Perfy_Trace_Passthrough("Leave", "L:At file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:79:0", self.x+(dx or 0),self.y+(dy or 0)) end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_LayoutColumn file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:77:6"); return L end
local function UI_TextTL(parent,font,x,y,text,skinFn) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_TextTL file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:81:6"); return Perfy_Trace_Passthrough("Leave", "UI_TextTL file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:81:6", UI_Text(parent,font,"TOPLEFT",parent,"TOPLEFT",x,y,text,skinFn)) end
local function UI_BtnTL(parent,text,w,h,x,y,onClick,tipTitle,tipBody,skinFn,template) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_BtnTL file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:82:6"); return Perfy_Trace_Passthrough("Leave", "UI_BtnTL file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:82:6", UI_Btn(parent,text,w,h,"TOPLEFT",parent,"TOPLEFT",x,y,onClick,tipTitle,tipBody,skinFn,template)) end
local function MSUF_JoinLines(lines) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_JoinLines file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:83:6"); if type(lines)~="table"then return Perfy_Trace_Passthrough("Leave", "MSUF_JoinLines file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:83:6", tostring(lines or"")) end
return Perfy_Trace_Passthrough("Leave", "MSUF_JoinLines file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:83:6", table.concat(lines,"\n")) end
function MSUF_BuildButtonRowTL(parent,x,y,defs,defaultGap) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_BuildButtonRowTL file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:85:0"); local out,prev={},nil for i,d in ipairs(defs or{})do local gap=d.gap if gap==nil then gap=defaultGap end
if gap==nil then gap=8 end
local b if i==1 then b=UI_BtnTL(parent,d.text,d.w,d.h,x,y,d.onClick,d.tipTitle,d.tipBody,d.skinFn,d.template)else b=UI_Btn(parent,d.text,d.w,d.h,"LEFT",prev,"RIGHT",gap,0,d.onClick,d.tipTitle,d.tipBody,d.skinFn,d.template)end
out[i]=b;prev=b if d.post then pcall(d.post,b)end
end
function MSUF_BuildButtonRow(parent,anchorFrame,a1,a2,x,y,defs,defaultGap) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_BuildButtonRow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:90:0"); local out,prev={},nil for i,d in ipairs(defs or{})do local gap=d.gap if gap==nil then gap=defaultGap end
if gap==nil then gap=8 end
local b if i==1 then b=UI_Btn(parent,d.text,d.w,d.h,a1,anchorFrame,a2,x,y,d.onClick,d.tipTitle,d.tipBody,d.skinFn,d.template)else b=UI_Btn(parent,d.text,d.w,d.h,"LEFT",prev,"RIGHT",gap,0,d.onClick,d.tipTitle,d.tipBody,d.skinFn,d.template)end
out[i]=b;prev=b if d.post then pcall(d.post,b)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_BuildButtonRow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:90:0"); return out end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_BuildButtonRowTL file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:85:0"); return out end
local function UI_BtnTo(parent,text,w,h,anchor,relPoint,x,y,onClick,tipTitle,tipBody,skinFn,template) Perfy_Trace(Perfy_GetTime(), "Enter", "UI_BtnTo file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:97:6"); return Perfy_Trace_Passthrough("Leave", "UI_BtnTo file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:97:6", UI_Btn(parent,text,w,h,anchor,parent,relPoint or anchor,x,y,onClick,tipTitle,tipBody,skinFn,template)) end
local function MSUF_AttachManualResizeGrip(frame) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_AttachManualResizeGrip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:98:6"); if not frame or frame._msufResizeGrip then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_AttachManualResizeGrip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:98:6"); return end
local grip=CreateFrame("Button",nil,frame);grip:SetSize(16,16)grip:SetPoint("BOTTOMRIGHT",frame,"BOTTOMRIGHT",-2,2);grip:SetNormalTexture("Interface\\ChatFrame\\UI-ChatIM-SizeGrabber-Up")grip:SetHighlightTexture("Interface\\ChatFrame\\UI-ChatIM-SizeGrabber-Highlight");grip:SetPushedTexture("Interface\\ChatFrame\\UI-ChatIM-SizeGrabber-Down")local function Stop() Perfy_Trace(Perfy_GetTime(), "Enter", "Stop file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:99:348"); if not frame._msufResizing then Perfy_Trace(Perfy_GetTime(), "Leave", "Stop file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:99:348"); return end
frame._msufResizing=false if grip and grip.SetScript then grip:SetScript("OnUpdate",nil)end
if MSUF_SaveWindowGeometry then MSUF_SaveWindowGeometry(frame,frame._msufGeomKey or"full")end
Perfy_Trace(Perfy_GetTime(), "Leave", "Stop file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:99:348"); end
grip:SetScript("OnMouseDown",function(self,btn) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:103:29"); if btn~="LeftButton"then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:103:29"); return end
if not(frame and frame.GetWidth and frame.GetHeight)then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:103:29"); return end
local cx,cy=GetCursorPosition()frame._msufResizing=true frame._msufResizeStartX=cx frame._msufResizeStartY=cy frame._msufResizeStartW=frame:GetWidth()frame._msufResizeStartH=frame:GetHeight()self:SetScript("OnUpdate",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:105:217"); if not frame._msufResizing then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:105:217"); return end
local x,y=GetCursorPosition();local s=(frame.GetEffectiveScale and frame:GetEffectiveScale())or 1 if s==0 then s=1 end
local dw=(x-(frame._msufResizeStartX or x))/s;local dh=((frame._msufResizeStartY or y)-y)/s;local newW=(frame._msufResizeStartW or frame:GetWidth())+dw;local newH=(frame._msufResizeStartH or frame:GetHeight())+dh;local minW=frame._msufMinW or 760 local minH=frame._msufMinH or 520;local maxW=frame._msufMaxW or 2200;local maxH=frame._msufMaxH or 1400 frame:SetSize(clamp(newW,minW,maxW),clamp(newH,minH,maxH)) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:105:217"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:103:29"); end
)grip:SetScript("OnMouseUp",Stop);grip:SetScript("OnHide",Stop)do local prev=frame.GetScript and frame:GetScript("OnMouseUp");frame:SetScript("OnMouseUp",function(self,btn) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:109:154"); Stop()if prev then pcall(prev,self,btn)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:109:154"); end
)end
frame._msufResizeGrip=grip frame._msufStopManualResize=Stop Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_AttachManualResizeGrip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:98:6"); end
local function MSUF_EnsureGeneral() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureGeneral file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:113:6"); MSUF_SafeCall(EnsureDB)if type(MSUF_DB)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureGeneral file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:113:6"); return nil end
MSUF_DB.general=MSUF_DB.general or{}return Perfy_Trace_Passthrough("Leave", "MSUF_EnsureGeneral file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:113:6", MSUF_DB.general) end
local function MSUF_GetGeomPrefix(which) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetGeomPrefix file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:115:6"); Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetGeomPrefix file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:115:6"); return"flashFull"end
MSUF_RegisterEscClose=function(frame) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_RegisterEscClose file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:116:22"); if not frame or not frame.GetName then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_RegisterEscClose file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:116:22"); return end
local name=frame:GetName()if not name or name==""then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_RegisterEscClose file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:116:22"); return end
if type(UISpecialFrames)=="table"then for _,v in ipairs(UISpecialFrames)do if v==name then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_RegisterEscClose file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:116:22"); return end
end
table.insert(UISpecialFrames,name)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_RegisterEscClose file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:116:22"); end
MSUF_SaveWindowGeometry=function(frame,which) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SaveWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:122:24"); if not frame or not frame.GetWidth or not frame.GetHeight or not frame.GetPoint then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SaveWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:122:24"); return end
local g=MSUF_EnsureGeneral()if not g then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SaveWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:122:24"); return end
local pfx=MSUF_GetGeomPrefix(which);local w=frame:GetWidth();local h=frame:GetHeight()if w and h then g[pfx.."W"]=w g[pfx.."H"]=h end
local point,relTo,relPoint,xOfs,yOfs=frame:GetPoint(1)if point and relPoint and xOfs and yOfs then g[pfx.."Point"]=point g[pfx.."RelPoint"]=relPoint local s=(UIParent and UIParent.GetScale and UIParent:GetScale())or 1 if not s or s==0 then s=1 end
g[pfx.."X"]=xOfs g[pfx.."Y"]=yOfs g[pfx.."Xpx"]=(tonumber(xOfs)or 0)*s g[pfx.."Ypx"]=(tonumber(yOfs)or 0)*s end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SaveWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:122:24"); end
MSUF_LoadWindowGeometry=function(frame,which,defaultW,defaultH,defaultPoint,defaultX,defaultY) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_LoadWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:128:24"); if not frame then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_LoadWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:128:24"); return end
local g=MSUF_EnsureGeneral();local pfx=MSUF_GetGeomPrefix(which);local w=defaultW;local h=defaultH;local point=defaultPoint or"CENTER"local relPoint=point;local x=defaultX or 0;local y=defaultY or 0 if g then w=tonumber(g[pfx.."W"])or w h=tonumber(g[pfx.."H"])or h point=g[pfx.."Point"]or point relPoint=g[pfx.."RelPoint"]or relPoint local s=(UIParent and UIParent.GetScale and UIParent:GetScale())or 1 if not s or s==0 then s=1 end
local xpx=tonumber(g[pfx.."Xpx"]);local ypx=tonumber(g[pfx.."Ypx"])if xpx~=nil then x=xpx/s else x=tonumber(g[pfx.."X"])or x end
if ypx~=nil then y=ypx/s else y=tonumber(g[pfx.."Y"])or y end
end
local minW=frame._msufMinW or 760;local minH=frame._msufMinH or 520;local maxW=frame._msufMaxW or 2200;local maxH=frame._msufMaxH or 1400 if w and h then w=clamp(w,minW,maxW)h=clamp(h,minH,maxH)if frame.SetSize then frame:SetSize(w,h)end
end
if frame.ClearAllPoints and frame.SetPoint then frame:ClearAllPoints()frame:SetPoint(point,UIParent,relPoint,x,y)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_LoadWindowGeometry file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:128:24"); end
MSUF_AddTooltip=function(widget,title,body) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_AddTooltip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:137:16"); if not widget or not widget.SetScript then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_AddTooltip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:137:16"); return end
widget:SetScript("OnEnter",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:138:27"); if not GameTooltip then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:138:27"); return end
GameTooltip:SetOwner(self,"ANCHOR_RIGHT")if title and title~=""then GameTooltip:SetText(title,1,1,1)end
if body and body~=""then GameTooltip:AddLine(body,0.80,0.86,1.00,true)end
GameTooltip:Show() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:138:27"); end
)widget:SetScript("OnLeave",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:142:28"); if GameTooltip then GameTooltip:Hide()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:142:28"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_AddTooltip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:137:16"); end
local MSUF_GetNextTip MSUF_PickSessionTip=function() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_PickSessionTip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:145:42"); local tip=(_G.MSUF_GetNextTip and _G.MSUF_GetNextTip())if tip then S.mirror.tipText=tip end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_PickSessionTip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:145:42"); end
local MSUF_THEME={bgR=0.03,bgG=0.05,bgB=0.12,bgA=0.95,edgeR=0.10,edgeG=0.20,edgeB=0.45,edgeA=0.90,titleR=0.75,titleG=0.88,titleB=1.00,titleA=1.00,textR=0.86,textG=0.92,textB=1.00,textA=1.00}local function MSUF_Clamp01(x) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Clamp01 file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:147:196"); x=tonumber(x)or 0 if x<0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Clamp01 file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:147:196"); return 0 end
if x>1 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Clamp01 file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:147:196"); return 1 end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Clamp01 file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:147:196"); return x end
local MSUF_PILL_EDGE_R=MSUF_Clamp01((MSUF_THEME.edgeR or 0.10)*1.25);local MSUF_PILL_EDGE_G=MSUF_Clamp01((MSUF_THEME.edgeG or 0.20)*1.25);local MSUF_PILL_EDGE_B=MSUF_Clamp01((MSUF_THEME.edgeB or 0.45)*1.18);local MSUF_PILL_EDGE_A=MSUF_Clamp01((MSUF_THEME.edgeA or 0.90)+0.05);local MSUF_SUPERELLIPSE_TEX="Interface/AddOns/"..tostring(addonName or"MidnightSimpleUnitFrames").."/Media/superellipse.tga"local function MSUF_EnsureSuperellipseLayers(btn,inset) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureSuperellipseLayers file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:150:406"); if not btn or not btn.CreateTexture then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureSuperellipseLayers file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:150:406"); return nil,nil end
inset=tonumber(inset)or 2 local function SnapOff(tex) Perfy_Trace(Perfy_GetTime(), "Enter", "SnapOff file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:151:32"); if tex and tex.SetSnapToPixelGrid then tex:SetSnapToPixelGrid(false)if tex.SetTexelSnappingBias then tex:SetTexelSnappingBias(0)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "SnapOff file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:151:32"); end
local function MakeGroup(key,layer,subLevel) Perfy_Trace(Perfy_GetTime(), "Enter", "MakeGroup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:154:6"); local g=btn[key]if g then Perfy_Trace(Perfy_GetTime(), "Leave", "MakeGroup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:154:6"); return g end
g={}g.L=btn:CreateTexture(nil,layer,nil,subLevel or 0)g.M=btn:CreateTexture(nil,layer,nil,subLevel or 0)g.R=btn:CreateTexture(nil,layer,nil,subLevel or 0)g._msufSEParts={g.L,g.M,g.R}g.L:SetTexture(MSUF_SUPERELLIPSE_TEX)g.M:SetTexture(MSUF_SUPERELLIPSE_TEX)g.R:SetTexture(MSUF_SUPERELLIPSE_TEX)g.L:SetTexCoord(0.0,0.25,0.0,1.0)g.M:SetTexCoord(0.25,0.75,0.0,1.0)g.R:SetTexCoord(0.75,1.0,0.0,1.0)SnapOff(g.L);SnapOff(g.M);SnapOff(g.R)g.SetVertexColor=function(self,r,gg,b,a) Perfy_Trace(Perfy_GetTime(), "Enter", "g.SetVertexColor file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:155:448"); for i=1,#self._msufSEParts do local t=self._msufSEParts[i]if t and t.SetVertexColor then t:SetVertexColor(r,gg,b,a)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "g.SetVertexColor file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:155:448"); end
g.Hide=function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "g.Hide file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:158:7"); for i=1,#self._msufSEParts do local t=self._msufSEParts[i];if t and t.Hide then t:Hide()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "g.Hide file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:158:7"); end
g.Show=function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "g.Show file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:161:7"); for i=1,#self._msufSEParts do local t=self._msufSEParts[i];if t and t.Show then t:Show()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "g.Show file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:161:7"); end
btn[key]=g Perfy_Trace(Perfy_GetTime(), "Leave", "MakeGroup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:154:6"); return g end
local border=MakeGroup("_msufSEBorder3","BACKGROUND",0);local fill=MakeGroup("_msufSEFill3","BACKGROUND",1)if btn.SetClipsChildren then pcall(btn.SetClipsChildren,btn,true)end
local function Layout(g,pad) Perfy_Trace(Perfy_GetTime(), "Enter", "Layout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:166:6"); local w=(btn.GetWidth and btn:GetWidth())or 140;local h=(btn.GetHeight and btn:GetHeight())or 22;local innerW=math.max(1,w-pad*2);local innerH=math.max(1,h-pad*2);local r=math.floor(innerH*0.5+0.5)local capW=math.min(r,math.floor(innerW*0.5))g.L:ClearAllPoints()g.M:ClearAllPoints()g.R:ClearAllPoints()g.L:SetPoint("TOPLEFT",btn,"TOPLEFT",pad,-pad)g.L:SetPoint("BOTTOMLEFT",btn,"BOTTOMLEFT",pad,pad)g.L:SetWidth(capW)g.R:SetPoint("TOPRIGHT",btn,"TOPRIGHT",-pad,-pad)g.R:SetPoint("BOTTOMRIGHT",btn,"BOTTOMRIGHT",-pad,pad)g.R:SetWidth(capW)g.M:SetPoint("TOPLEFT",g.L,"TOPRIGHT",0,0)g.M:SetPoint("BOTTOMRIGHT",g.R,"BOTTOMLEFT",0,0) Perfy_Trace(Perfy_GetTime(), "Leave", "Layout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:166:6"); end
Layout(border,1)Layout(fill,math.max(2,inset))if btn.HookScript and not btn._msufSE3Hooked then btn._msufSE3Hooked=true btn:HookScript("OnSizeChanged",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:167:151"); Layout(border,1);Layout(fill,math.max(2,inset)) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:167:151"); end
)end
if border and border.SetVertexColor then border:SetVertexColor(MSUF_PILL_EDGE_R,MSUF_PILL_EDGE_G,MSUF_PILL_EDGE_B,MSUF_PILL_EDGE_A)end
if fill and fill.SetVertexColor then fill:SetVertexColor(MSUF_THEME.bgR,MSUF_THEME.bgG,MSUF_THEME.bgB,0.90)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureSuperellipseLayers file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:150:406"); return fill,border end
local MSUF_TIPS={"Bigger steps: Hold |cff00ff00SHIFT|r while adjusting sliders to change values faster.","Fine tuning: Hold |cff00ff00CTRL|r while adjusting sliders for smaller steps.","Quick reset: If something feels off, try |cff00ff00/msuf reset|r (frame positions).","Factory reset: Use |cff00ff00Menu → Advanced → Factory Reset|r (or /msuf fullreset confirm + /reload).","Edit Mode: Use |cff00ff00Toggle Edit Mode|r to move frames quickly, then fine-tune with the position popup.","Profiles safety: Create a new profile before big experiments — switch back instantly if needed.","Colors: The |cff00ff00Colors|r tab lets you customize almost everything (fonts, bars, castbars, highlights).","Gameplay: The |cff00ff00Gameplay|r tab contains extra UI tools and warnings you can enable/disable.","Recommended: |cff00ff00Sensei Resource Bar|r pairs insanely well with MSUF to track resources cleanly.","UI scale tip: MSUF has its own UI scale — separate from the Global UI scale.","Troubleshoot: If visuals don’t update, a quick |cff00ff00/reload|r fixes most UI state issues.","Readability: Slightly larger fonts often help more than bigger frames (especially in raids).","During development of MSUF Unhalted, R41z0r and other great addon developers helped out!","Danders is a great Party/Raidframe addon and works really well with MSUF","Community: If you like MSUF, share it with a friend — UI addons grow by word of mouth.",}MSUF_GetNextTip=function() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetNextTip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:172:1457"); local tips=MSUF_TIPS if not tips or#tips==0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetNextTip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:172:1457"); return nil,0,0 end
local general=MSUF_EnsureGeneral();local idx=1 if general then idx=(tonumber(general.tipCycleIndex)or 0)+1 if idx>#tips then idx=1 end
general.tipCycleIndex=idx end
return Perfy_Trace_Passthrough("Leave", "MSUF_GetNextTip file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:172:1457", tips[idx],idx,#tips) end
_G.MSUF_GetNextTip=MSUF_GetNextTip local function MSUF_ForceItalicFont(fs) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ForceItalicFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:176:41"); if not fs or not fs.GetFont or not fs.SetFont then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ForceItalicFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:176:41"); return end
local font,size,flags=fs:GetFont()if not font or not size then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ForceItalicFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:176:41"); return end
flags=flags or""if flags:find("ITALIC")then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ForceItalicFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:176:41"); return end
if flags~=""then flags=flags..",ITALIC"else flags="ITALIC"end
fs:SetFont(font,size,flags) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ForceItalicFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:176:41"); end
local MSUF_PRESETS=(ns and ns.MSUF_PRESETS)or _G.MSUF_PRESETS if type(MSUF_PRESETS)~="table"then MSUF_PRESETS={}end
local MSUF_PRESET_ALLOWED_KEYS={"general","player","target","focus","pet","targettarget","boss","bars","auras","gameplay","npcColors","classColors","shortenNames",}local function MSUF_WipeTable(t) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_WipeTable file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:182:170"); if type(t)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_WipeTable file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:182:170"); return end
for k in pairs(t)do t[k]=nil end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_WipeTable file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:182:170"); end
local function MSUF_DeepCopy(src,depth) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_DeepCopy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:185:6"); if type(src)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_DeepCopy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:185:6"); return src end
depth=(depth or 0)+1 if depth>30 then return Perfy_Trace_Passthrough("Leave", "MSUF_DeepCopy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:185:6", {}) end
local dst={}for k,v in pairs(src)do if type(v)=="table"then dst[k]=MSUF_DeepCopy(v,depth)else dst[k]=v end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_DeepCopy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:185:6"); return dst end
local function MSUF_CopyValue(v) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_CopyValue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:190:6"); if type(v)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_CopyValue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:190:6"); return v end
if type(CopyTable)=="function"then return Perfy_Trace_Passthrough("Leave", "MSUF_CopyValue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:190:6", CopyTable(v)) end
return Perfy_Trace_Passthrough("Leave", "MSUF_CopyValue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:190:6", MSUF_DeepCopy(v)) end
local MSUF_ShowReloadRecommendedPopup local function MSUF_ApplyPreset(presetName) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ApplyPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:193:44"); local preset=MSUF_PRESETS and MSUF_PRESETS[presetName]if type(preset)~="table"then print("|cffff3333MSUF:|r Preset not found: "..tostring(presetName)) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:193:44"); return end
if type(MSUF_InitProfiles)=="function"then pcall(MSUF_InitProfiles)end
if type(MSUF_DB)~="table"then print("|cffff3333MSUF:|r DB not ready (MSUF_DB missing).") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:193:44"); return end
local importStr=preset._msufImportString or preset._msufImport if type(importStr)=="string"then local okPrefix,prefix=pcall(string.match,importStr,"^%s*(MSUF%d+):")if okPrefix and(prefix=="MSUF2"or prefix=="MSUF3")then local imp=_G and _G.MSUF_ImportFromString if type(imp)=="function"then pcall(imp,importStr)if type(ApplyAllSettings)=="function"then pcall(ApplyAllSettings)end
if type(UpdateAllFonts)=="function"then pcall(UpdateAllFonts)end
print("|cff00ff00MSUF:|r Loaded preset: "..tostring(presetName))if type(MSUF_ShowReloadRecommendedPopup)=="function"then MSUF_ShowReloadRecommendedPopup("Preset: "..tostring(presetName))end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:193:44"); return else print("|cffff3333MSUF:|r Cannot load this preset (MSUF_ImportFromString missing).")end
end
end
MSUF_WipeTable(MSUF_DB)for _,key in ipairs(MSUF_PRESET_ALLOWED_KEYS)do local val=preset[key]if val~=nil then MSUF_DB[key]=MSUF_CopyValue(val)end
end
if type(EnsureDB)=="function"then pcall(EnsureDB)end
if type(ApplyAllSettings)=="function"then pcall(ApplyAllSettings)end
if type(UpdateAllFonts)=="function"then pcall(UpdateAllFonts)end
print("|cff00ff00MSUF:|r Loaded preset: "..tostring(presetName))if type(MSUF_ShowReloadRecommendedPopup)=="function"then MSUF_ShowReloadRecommendedPopup("Preset: "..tostring(presetName))end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:193:44"); end
local function MSUF_GetPresetNames() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetPresetNames file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:209:6"); local names={}if type(MSUF_PRESETS)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetPresetNames file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:209:6"); return names end
for name in pairs(MSUF_PRESETS)do table.insert(names,name)end
table.sort(names) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetPresetNames file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:209:6"); return names end
local MSUF_PENDING_PRESET=nil local function MSUF_ShowPresetConfirm(presetName) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowPresetConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:212:36"); if not presetName or presetName==""then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowPresetConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:212:36"); return end
MSUF_PENDING_PRESET=presetName local preset=MSUF_PRESETS and MSUF_PRESETS[presetName];local warn=preset and preset._msufWarning if warn~=nil and warn~=""then warn=tostring(warn)else warn=nil end
if not StaticPopupDialogs["MSUF_LOAD_PRESET_CONFIRM"]then StaticPopupDialogs["MSUF_LOAD_PRESET_CONFIRM"]={text="Load preset: %s?\n\nThis will overwrite your CURRENT active profile settings.",button1=YES,button2=NO,timeout=0,whileDead=1,hideOnEscape=1,preferredIndex=3,OnAccept=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:214:277"); if MSUF_PENDING_PRESET then MSUF_ApplyPreset(MSUF_PENDING_PRESET)end
MSUF_PENDING_PRESET=nil Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:214:277"); end
,OnCancel=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:216:10"); MSUF_PENDING_PRESET=nil Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:216:10"); end
,}end
local dlg=StaticPopupDialogs["MSUF_LOAD_PRESET_CONFIRM"]if dlg then if warn then dlg.text="Load preset: %s?\n\n|cffffaa00Warning:|r "..warn.."\n\nThis will overwrite your CURRENT active profile settings."else dlg.text="Load preset: %s?\n\nThis will overwrite your CURRENT active profile settings."end
end
StaticPopup_Show("MSUF_LOAD_PRESET_CONFIRM",presetName) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowPresetConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:212:36"); end
local MSUF_PENDING_RELOAD_RECOMMEND_LABEL=nil MSUF_ShowReloadRecommendedPopup=function(label) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowReloadRecommendedPopup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:221:78"); if InCombatLockdown and InCombatLockdown()then if type(MSUF_Print)=="function"then MSUF_Print("Reload recommended (cannot show popup in combat).")else print("|cffffaa00MSUF:|r Reload recommended (cannot show popup in combat).")end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowReloadRecommendedPopup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:221:78"); return end
MSUF_PENDING_RELOAD_RECOMMEND_LABEL=tostring(label or"")if MSUF_PENDING_RELOAD_RECOMMEND_LABEL==""then MSUF_PENDING_RELOAD_RECOMMEND_LABEL="these changes"end
if not StaticPopupDialogs["MSUF_RELOAD_RECOMMENDED"]then StaticPopupDialogs["MSUF_RELOAD_RECOMMENDED"]={text="MSUF recommends reloading the UI to ensure all changes apply correctly.\n\nApply: %s\n\nReload now?",button1="Reload",button2="Not now",timeout=0,whileDead=1,hideOnEscape=1,preferredIndex=3,OnAccept=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:224:309"); MSUF_PENDING_RELOAD_RECOMMEND_LABEL=nil if type(ReloadUI)=="function"then ReloadUI()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:224:309"); end
,OnCancel=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:226:10"); MSUF_PENDING_RELOAD_RECOMMEND_LABEL=nil Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:226:10"); end
,}end
StaticPopup_Show("MSUF_RELOAD_RECOMMENDED",MSUF_PENDING_RELOAD_RECOMMEND_LABEL) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowReloadRecommendedPopup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:221:78"); end
local MSUF_PENDING_RELOAD_LABEL=nil;local MSUF_PENDING_RELOAD_FN=nil local function MSUF_ShowReloadConfirm(label,fn) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowReloadConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:229:75"); if InCombatLockdown and InCombatLockdown()then MSUF_Print("Cannot reload UI in combat.") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowReloadConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:229:75"); return end
MSUF_PENDING_RELOAD_LABEL=tostring(label or"")MSUF_PENDING_RELOAD_FN=fn if not StaticPopupDialogs["MSUF_RELOAD_UI_CONFIRM"]then StaticPopupDialogs["MSUF_RELOAD_UI_CONFIRM"]={text="Reload UI now?\n\nThis will apply: %s",button1=YES,button2=NO,timeout=0,whileDead=1,hideOnEscape=1,preferredIndex=3,OnAccept=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:230:305"); local f=MSUF_PENDING_RELOAD_FN;MSUF_PENDING_RELOAD_FN=nil MSUF_PENDING_RELOAD_LABEL=nil if type(f)=="function"then pcall(f)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:230:305"); end
,OnCancel=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:232:10"); MSUF_PENDING_RELOAD_FN=nil;MSUF_PENDING_RELOAD_LABEL=nil Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:232:10"); end
,}end
StaticPopup_Show("MSUF_RELOAD_UI_CONFIRM",MSUF_PENDING_RELOAD_LABEL) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowReloadConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:229:75"); end
local MSUF_CopyLinkPopup=nil local function MSUF_EnsureCopyLinkPopup() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureCopyLinkPopup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:235:35"); if MSUF_CopyLinkPopup then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureCopyLinkPopup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:235:35"); return MSUF_CopyLinkPopup end
local f=CreateFrame("Frame","MSUF_CopyLinkPopup",UIParent,"BackdropTemplate")f:SetSize(420,150)f:SetFrameStrata("DIALOG")f:SetClampedToScreen(true)f:EnableMouse(true)f:SetMovable(true)f:RegisterForDrag("LeftButton")f:SetScript("OnDragStart",f.StartMoving)f:SetScript("OnDragStop",f.StopMovingOrSizing)f:SetBackdrop({bgFile="Interface/Tooltips/UI-Tooltip-Background",edgeFile="Interface/Tooltips/UI-Tooltip-Border",tile=true,tileSize=16,edgeSize=16,insets={left=4,right=4,top=4,bottom=4},})f:SetBackdropColor(0,0,0,0.90)f:SetBackdropBorderColor(0.10,0.10,0.10,0.90)local titleFS=f:CreateFontString(nil,"OVERLAY","GameFontNormalLarge")titleFS:SetPoint("TOP",f,"TOP",0,-14)titleFS:SetText("Link")f._msufTitleFS=titleFS local hintFS=f:CreateFontString(nil,"OVERLAY","GameFontNormal")hintFS:SetPoint("TOP",titleFS,"BOTTOM",0,-6)hintFS:SetText("Press Ctrl+C to copy:")hintFS:SetTextColor(0.90,0.90,0.90,1)local eb=CreateFrame("EditBox",nil,f,"InputBoxTemplate")eb:SetAutoFocus(false)eb:SetSize(360,32)eb:SetPoint("TOP",hintFS,"BOTTOM",0,-10)if eb.SetTextInsets then eb:SetTextInsets(8,8,0,0)end
eb:SetScript("OnEscapePressed",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:237:31"); f:Hide() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:237:31"); end
)eb:SetScript("OnEnterPressed",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:238:31"); f:Hide() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:238:31"); end
)f._msufEditBox=eb local ok=CreateFrame("Button",nil,f,"UIPanelButtonTemplate")ok:SetSize(120,24)ok:SetPoint("BOTTOM",f,"BOTTOM",0,12)ok:SetText(OKAY)ok:SetScript("OnClick",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:239:173"); f:Hide() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:239:173"); end
)if type(MSUF_SkinButton)=="function"then MSUF_SkinButton(ok)end
f:SetScript("OnShow",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:241:21"); if self._msufTitleFS then self._msufTitleFS:SetText(self._msufTitle or"Link")end
if self._msufEditBox then self._msufEditBox:SetText(self._msufUrl or"");self._msufEditBox:HighlightText()self._msufEditBox:SetFocus()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:241:21"); end
)f:SetScript("OnHide",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:244:22"); if self._msufEditBox then self._msufEditBox:SetText("");self._msufEditBox:ClearFocus()end
self._msufTitle=nil;self._msufUrl=nil Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:244:22"); end
)f:Hide()MSUF_CopyLinkPopup=f Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureCopyLinkPopup file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:235:35"); return f end
local function MSUF_ShowCopyLink(title,url) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowCopyLink file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:247:6"); local f=MSUF_EnsureCopyLinkPopup()f._msufTitle=tostring(title or"Link")f._msufUrl=tostring(url or"")f:ClearAllPoints()f:SetPoint("CENTER",UIParent,"CENTER",0,0)f:Show()if f.Raise then f:Raise()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowCopyLink file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:247:6"); end
local MIRROR_PANEL_SCALE=1.00;local MENU_FONT_BUMP=3;local MIRRORED_PANEL_FONT_BUMP=1;local MSUF_MIRROR_MAIN_CROP_Y=42;local MSUF_MIRROR_DEEPLINK_CROP_Y=96 local function MSUF_ApplyMidnightBackdrop(frame,alphaOverride) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ApplyMidnightBackdrop file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:249:162"); if not frame or not frame.SetBackdrop then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMidnightBackdrop file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:249:162"); return end
frame:SetBackdrop({bgFile="Interface/Tooltips/UI-Tooltip-Background",edgeFile="Interface/Tooltips/UI-Tooltip-Border",tile=true,tileSize=16,edgeSize=16,insets={left=3,right=3,top=3,bottom=3},})local a=alphaOverride or MSUF_THEME.bgA frame:SetBackdropColor(MSUF_THEME.bgR,MSUF_THEME.bgG,MSUF_THEME.bgB,a)if frame.SetBackdropBorderColor then frame:SetBackdropBorderColor(MSUF_THEME.edgeR,MSUF_THEME.edgeG,MSUF_THEME.edgeB,MSUF_THEME.edgeA)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMidnightBackdrop file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:249:162"); end
local function MSUF_SkinTitle(fs) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SkinTitle file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:252:6"); if fs and fs.SetTextColor then fs:SetTextColor(MSUF_THEME.titleR,MSUF_THEME.titleG,MSUF_THEME.titleB,MSUF_THEME.titleA)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinTitle file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:252:6"); end
local function MSUF_SkinText(fs) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SkinText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:254:6"); if fs and fs.SetTextColor then fs:SetTextColor(MSUF_THEME.textR,MSUF_THEME.textG,MSUF_THEME.textB,MSUF_THEME.textA)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:254:6"); end
local function MSUF_SkinMuted(fs) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SkinMuted file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:256:6"); if fs and fs.SetTextColor then fs:SetTextColor(MSUF_THEME.textR*0.80,MSUF_THEME.textG*0.80,MSUF_THEME.textB*0.80,0.85)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinMuted file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:256:6"); end
local function MSUF_EnsureNavActiveOverlay(btn,fillGroup) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureNavActiveOverlay file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:258:6"); if not(btn and btn.CreateTexture and fillGroup and fillGroup.L and fillGroup.M and fillGroup.R)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureNavActiveOverlay file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:258:6"); return nil end
if btn._msufNavActive3 then local g=btn._msufNavActive3 if g and g.L and g.L.SetAllPoints then g.L:SetAllPoints(fillGroup.L)end
if g and g.M and g.M.SetAllPoints then g.M:SetAllPoints(fillGroup.M)end
if g and g.R and g.R.SetAllPoints then g.R:SetAllPoints(fillGroup.R)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureNavActiveOverlay file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:258:6"); return g end
local g={}g.L=btn:CreateTexture(nil,"ARTWORK",nil,2)g.M=btn:CreateTexture(nil,"ARTWORK",nil,2)g.R=btn:CreateTexture(nil,"ARTWORK",nil,2)g._msufSEParts={g.L,g.M,g.R}g.L:SetTexture(MSUF_SUPERELLIPSE_TEX)g.M:SetTexture(MSUF_SUPERELLIPSE_TEX)g.R:SetTexture(MSUF_SUPERELLIPSE_TEX)g.L:SetTexCoord(0.0,0.25,0.0,1.0)g.M:SetTexCoord(0.25,0.75,0.0,1.0)g.R:SetTexCoord(0.75,1.0,0.0,1.0)for i=1,#g._msufSEParts do local t=g._msufSEParts[i]if t and t.SetSnapToPixelGrid then t:SetSnapToPixelGrid(false)if t.SetTexelSnappingBias then t:SetTexelSnappingBias(0)end
end
end
g.SetVertexColor=function(self,r,gg,b,a) Perfy_Trace(Perfy_GetTime(), "Enter", "g.SetVertexColor file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:266:17"); for i=1,#self._msufSEParts do local t=self._msufSEParts[i]if t and t.SetVertexColor then t:SetVertexColor(r,gg,b,a)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "g.SetVertexColor file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:266:17"); end
g.Hide=function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "g.Hide file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:269:7"); for i=1,#self._msufSEParts do local t=self._msufSEParts[i]if t and t.Hide then t:Hide()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "g.Hide file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:269:7"); end
g.Show=function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "g.Show file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:272:7"); for i=1,#self._msufSEParts do local t=self._msufSEParts[i]if t and t.Show then t:Show()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "g.Show file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:272:7"); end
g.L:SetAllPoints(fillGroup.L)g.M:SetAllPoints(fillGroup.M)g.R:SetAllPoints(fillGroup.R)g:Hide()btn._msufNavActive3=g Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureNavActiveOverlay file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:258:6"); return g end
MSUF_SkinButton=function(btn) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SkinButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:276:16"); if not btn then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:276:16"); return end
if btn.__MSUF_MidnightSkinned or btn.__MSUF_NavSkinned or btn.__MSUF_DashSkinned then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:276:16"); return end
btn.__MSUF_MidnightSkinned=true local looksPanel=false if(btn.Left and btn.Middle and btn.Right)then looksPanel=true elseif btn.GetRegions then local regions={btn:GetRegions()}for i=1,#regions do local r=regions[i]if r and r.GetObjectType and r:GetObjectType()=="Texture"and r.GetTexture then local ok,tex=pcall(r.GetTexture,r)if ok and type(tex)=="string"then if tex:find("UI%-Panel%-Button")or tex:find("UIPanelButton")then looksPanel=true break end
end
end
end
end
if not looksPanel then local nt=btn.GetNormalTexture and btn:GetNormalTexture()if nt and nt.SetVertexColor then nt:SetVertexColor(0.18,0.36,0.90,1.00)end
local pt=btn.GetPushedTexture and btn:GetPushedTexture()if pt and pt.SetVertexColor then pt:SetVertexColor(0.12,0.26,0.70,1.00)end
local ht=btn.GetHighlightTexture and btn:GetHighlightTexture()if ht and ht.SetVertexColor then ht:SetVertexColor(0.25,0.55,1.00,0.85)end
local dt=btn.GetDisabledTexture and btn:GetDisabledTexture()if dt and dt.SetVertexColor then dt:SetVertexColor(0.25,0.25,0.25,0.55)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:276:16"); return end
if btn.Left and btn.Left.Hide then btn.Left:Hide()end
if btn.Middle and btn.Middle.Hide then btn.Middle:Hide()end
if btn.Right and btn.Right.Hide then btn.Right:Hide()end
if btn.GetRegions then local regions={btn:GetRegions()}for i=1,#regions do local r=regions[i]if r and r.GetObjectType and r:GetObjectType()=="Texture"and r.GetTexture then local ok,tex=pcall(r.GetTexture,r)if ok and type(tex)=="string"then local isPanelArt=false if tex:find("UI%-Panel%-Button")or tex:find("UIPanelButton")then isPanelArt=true end
if isPanelArt then if r.SetAlpha then r:SetAlpha(0)end
if r.Hide then r:Hide()end
end
end
end
end
end
if btn.GetNormalTexture and btn.SetNormalTexture then local nt=btn:GetNormalTexture()if nt and nt.SetAlpha then nt:SetAlpha(0)end
pcall(btn.SetNormalTexture,btn,nil)end
if btn.GetPushedTexture and btn.SetPushedTexture then local pt=btn:GetPushedTexture()if pt and pt.SetAlpha then pt:SetAlpha(0)end
pcall(btn.SetPushedTexture,btn,nil)end
if btn.GetHighlightTexture and btn.SetHighlightTexture then local ht=btn:GetHighlightTexture()if ht and ht.SetAlpha then ht:SetAlpha(0)end
pcall(btn.SetHighlightTexture,btn,nil)end
if btn.GetDisabledTexture and btn.SetDisabledTexture then local dt=btn:GetDisabledTexture()if dt and dt.SetAlpha then dt:SetAlpha(0)end
pcall(btn.SetDisabledTexture,btn,nil)end
local bg,border=MSUF_EnsureSuperellipseLayers(btn,2)if border and border.SetVertexColor then border:SetVertexColor(MSUF_PILL_EDGE_R,MSUF_PILL_EDGE_G,MSUF_PILL_EDGE_B,0.90)end
if bg and bg.SetVertexColor then bg:SetVertexColor(0.09,0.10,0.12,0.92)end
btn._msufBtnBorder=border btn._msufBtnBG=bg btn._msufBtnBG_base={0.09,0.10,0.12,0.92}btn._msufBtnBG_hover={0.10,0.11,0.13,0.98}btn._msufBtnBG_pressed={0.08,0.09,0.11,0.98}local fs=btn.GetFontString and btn:GetFontString()if fs and fs.SetTextColor then fs:SetTextColor(MSUF_THEME.textR,MSUF_THEME.textG,MSUF_THEME.textB,MSUF_THEME.textA)if fs.SetShadowColor then fs:SetShadowColor(0,0,0,0.6)end
if fs.SetShadowOffset then fs:SetShadowOffset(1,-1)end
if fs.SetDrawLayer then fs:SetDrawLayer("OVERLAY",7)end
if fs.SetAlpha then fs:SetAlpha(1)end
if fs.Show then pcall(fs.Show,fs)end
if fs.GetText and fs.SetText then local ok,t=pcall(fs.GetText,fs)if ok then pcall(fs.SetText,fs,t or"")end
end
end
if btn.SetAlpha then btn:SetAlpha(1)end
if btn.HookScript and not btn.__msufBtnShowFix then btn.__msufBtnShowFix=true btn:HookScript("OnShow",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:318:102"); if self.SetAlpha then self:SetAlpha(1)end
local f=self.GetFontString and self:GetFontString()if f then if f.Show then pcall(f.Show,f)end
if f.SetDrawLayer then f:SetDrawLayer("OVERLAY",7)end
if f.SetAlpha then f:SetAlpha(1)end
if f.GetText and f.SetText then local ok,t=pcall(f.GetText,f)if ok then pcall(f.SetText,f,t or"")end
end
end
if self._msufBtnBG and self._msufBtnBG_base then local col=self._msufBtnBG_base if self._msufBtnBG.SetVertexColor then self._msufBtnBG:SetVertexColor(col[1],col[2],col[3],col[4])end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:318:102"); end
)end
if btn.HookScript and not btn.__msufBtnHideFix then btn.__msufBtnHideFix=true btn:HookScript("OnHide",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:329:102"); if self.UnlockHighlight then pcall(self.UnlockHighlight,self)end
if self.SetButtonState then pcall(self.SetButtonState,self,"NORMAL")end
if self._msufBtnBG and self._msufBtnBG_base and self._msufBtnBG.SetVertexColor then local col=self._msufBtnBG_base;self._msufBtnBG:SetVertexColor(col[1],col[2],col[3],col[4])end
if self.SetAlpha then self:SetAlpha(1)end
local f=self.GetFontString and self:GetFontString()if f then if f.SetDrawLayer then f:SetDrawLayer("OVERLAY",7)end
if f.SetAlpha then f:SetAlpha(1)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:329:102"); end
)end
local oldEnter=btn:GetScript("OnEnter");local oldLeave=btn:GetScript("OnLeave");local oldDown=btn:GetScript("OnMouseDown");local oldUp=btn:GetScript("OnMouseUp");local oldDis=btn:GetScript("OnDisable")local oldEn=btn:GetScript("OnEnable")local function ApplyBG(self,col) Perfy_Trace(Perfy_GetTime(), "Enter", "ApplyBG file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:338:244"); if not self or type(col)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyBG file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:338:244"); return end
local bg=self._msufBtnBG if bg and bg.SetVertexColor then bg:SetVertexColor(col[1],col[2],col[3],col[4])end
Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyBG file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:338:244"); end
btn:SetScript("OnEnter",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:341:24"); ApplyBG(self,self._msufBtnBG_hover or self._msufBtnBG_base)if oldEnter then pcall(oldEnter,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:341:24"); end
)btn:SetScript("OnLeave",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:343:25"); ApplyBG(self,self._msufBtnBG_base)if oldLeave then pcall(oldLeave,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:343:25"); end
)btn:SetScript("OnMouseDown",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:345:29"); ApplyBG(self,self._msufBtnBG_pressed or self._msufBtnBG_hover)if oldDown then pcall(oldDown,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:345:29"); end
)btn:SetScript("OnMouseUp",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:347:27"); if self.IsMouseOver and self:IsMouseOver()then ApplyBG(self,self._msufBtnBG_hover or self._msufBtnBG_base)else ApplyBG(self,self._msufBtnBG_base)end
if oldUp then pcall(oldUp,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:347:27"); end
)btn:SetScript("OnDisable",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:350:27"); if self._msufBtnBG then self._msufBtnBG:SetVertexColor(0.07,0.07,0.08,0.65)end
if self._msufBtnBorder and self._msufBtnBorder.SetVertexColor then self._msufBtnBorder:SetVertexColor(MSUF_PILL_EDGE_R,MSUF_PILL_EDGE_G,MSUF_PILL_EDGE_B,0.45)end
local f=self.GetFontString and self:GetFontString()if f and f.SetTextColor then f:SetTextColor(0.55,0.60,0.70,0.85)end
if oldDis then pcall(oldDis,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:350:27"); end
)btn:SetScript("OnEnable",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:355:26"); if self._msufBtnBG then self._msufBtnBG:SetVertexColor(0.09,0.10,0.12,0.92)end
if self._msufBtnBorder and self._msufBtnBorder.SetVertexColor then self._msufBtnBorder:SetVertexColor(MSUF_PILL_EDGE_R,MSUF_PILL_EDGE_G,MSUF_PILL_EDGE_B,0.90)end
local f=self.GetFontString and self:GetFontString()if f and f.SetTextColor then f:SetTextColor(MSUF_THEME.textR,MSUF_THEME.textG,MSUF_THEME.textB,MSUF_THEME.textA)end
if oldEn then pcall(oldEn,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:355:26"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:276:16"); end
local function MSUF_ApplyMidnightControlsToFrame(root) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ApplyMidnightControlsToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:361:6"); if not root or not root.GetChildren then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMidnightControlsToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:361:6"); return end
local function LooksLikePanelButton(b) Perfy_Trace(Perfy_GetTime(), "Enter", "LooksLikePanelButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:362:6"); if not b then Perfy_Trace(Perfy_GetTime(), "Leave", "LooksLikePanelButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:362:6"); return false end
if(b.Left and b.Middle and b.Right)then Perfy_Trace(Perfy_GetTime(), "Leave", "LooksLikePanelButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:362:6"); return true end
if not b.GetRegions then Perfy_Trace(Perfy_GetTime(), "Leave", "LooksLikePanelButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:362:6"); return false end
local regions={b:GetRegions()}for i=1,#regions do local r=regions[i]if r and r.GetObjectType and r:GetObjectType()=="Texture"and r.GetTexture then local ok,tex=pcall(r.GetTexture,r)if ok and type(tex)=="string"then if tex:find("UI%-Panel%-Button")or tex:find("UIPanelButton")then Perfy_Trace(Perfy_GetTime(), "Leave", "LooksLikePanelButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:362:6"); return true end
end
end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "LooksLikePanelButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:362:6"); return false end
local function MaybeFixCheckLabel(cb) Perfy_Trace(Perfy_GetTime(), "Enter", "MaybeFixCheckLabel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:370:6"); local fs=cb and(cb.Text or cb.text or(cb.GetFontString and cb:GetFontString()))if not(fs and fs.GetTextColor and fs.SetTextColor)then Perfy_Trace(Perfy_GetTime(), "Leave", "MaybeFixCheckLabel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:370:6"); return end
local r,g,b=fs:GetTextColor()if r and g and b and r>=0.86 and g>=0.66 and b<=0.45 then fs:SetTextColor(MSUF_THEME.textR,MSUF_THEME.textG,MSUF_THEME.textB,MSUF_THEME.textA)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MaybeFixCheckLabel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:370:6"); end
local function Walk(f) Perfy_Trace(Perfy_GetTime(), "Enter", "Walk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:373:6"); if not f then Perfy_Trace(Perfy_GetTime(), "Leave", "Walk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:373:6"); return end
if f.GetObjectType then local ot=f:GetObjectType()if ot=="Button"then if not(f.IsObjectType and f:IsObjectType("CheckButton"))then if LooksLikePanelButton(f)then MSUF_SkinButton(f)end
end
elseif ot=="CheckButton"then MaybeFixCheckLabel(f)end
end
if f.GetChildren then local kids={f:GetChildren()}for i=1,#kids do Walk(kids[i])end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "Walk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:373:6"); end
Walk(root) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMidnightControlsToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:361:6"); end
local function MSUF_SkinNavButton(btn,isHeader,isIndented) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SkinNavButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:382:6"); if not btn or btn.__MSUF_NavSkinned then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinNavButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:382:6"); return end
btn.__MSUF_NavSkinned=true if btn.SetEnabled then pcall(btn.SetEnabled,btn,true)end
if btn.Left and btn.Left.Hide then btn.Left:Hide()end
if btn.Middle and btn.Middle.Hide then btn.Middle:Hide()end
if btn.Right and btn.Right.Hide then btn.Right:Hide()end
if btn.GetNormalTexture and btn.SetNormalTexture then local nt=btn:GetNormalTexture()if nt and nt.SetAlpha then nt:SetAlpha(0)end
pcall(btn.SetNormalTexture,btn,nil)end
if btn.GetPushedTexture and btn.SetPushedTexture then local pt=btn:GetPushedTexture()if pt and pt.SetAlpha then pt:SetAlpha(0)end
pcall(btn.SetPushedTexture,btn,nil)end
if btn.GetHighlightTexture and btn.SetHighlightTexture then local ht=btn:GetHighlightTexture()if ht and ht.SetAlpha then ht:SetAlpha(0)end
pcall(btn.SetHighlightTexture,btn,nil)end
if btn.GetDisabledTexture and btn.SetDisabledTexture then local dt=btn:GetDisabledTexture()if dt and dt.SetAlpha then dt:SetAlpha(0)end
pcall(btn.SetDisabledTexture,btn,nil)end
local bg,border=MSUF_EnsureSuperellipseLayers(btn,2);local active=MSUF_EnsureNavActiveOverlay(btn,bg)if active and active.SetVertexColor then active:SetVertexColor(0.16,0.36,0.80,0.55)end
if border and border.SetVertexColor then border:SetVertexColor(MSUF_PILL_EDGE_R,MSUF_PILL_EDGE_G,MSUF_PILL_EDGE_B,0.90)end
if bg and bg.SetVertexColor then if isIndented then bg:SetVertexColor(0.09,0.10,0.12,0.82)else bg:SetVertexColor(0.09,0.10,0.12,0.92)end
end
btn._msufNavBorder=border btn._msufNavBG=bg local fs=btn.GetFontString and btn:GetFontString()if fs and fs.SetTextColor then if isHeader then fs:SetTextColor(0.86,0.92,1.00,0.92)else if isIndented then fs:SetTextColor(0.80,0.88,1.00,0.92)else fs:SetTextColor(0.82,0.90,1.00,1.00)end
end
end
btn._msufApplyNavState=function(self,activeState,hovered) Perfy_Trace(Perfy_GetTime(), "Enter", "btn._msufApplyNavState file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:402:23"); if self._msufNavActive3 then if activeState then self._msufNavActive3:Show()else self._msufNavActive3:Hide()end
end
activeState=activeState and true or false hovered=hovered and true or false local fs2=self.GetFontString and self:GetFontString()if fs2 and fs2 .SetTextColor then if activeState then fs2:SetTextColor(0.92,0.96,1.00,1.00)else if isHeader then fs2:SetTextColor(0.86,0.92,1.00,0.92)else if isIndented then fs2:SetTextColor(0.80,0.88,1.00,0.92)else fs2:SetTextColor(0.82,0.90,1.00,1.00)end
end
end
end
if self._msufNavBG and self._msufNavBG.SetVertexColor then if activeState then self._msufNavBG:SetVertexColor(0.12,0.22,0.40,0.98)else if hovered then if isIndented then self._msufNavBG:SetVertexColor(0.10,0.11,0.13,0.90)else self._msufNavBG:SetVertexColor(0.10,0.11,0.13,0.99)end
else if isIndented then self._msufNavBG:SetVertexColor(0.09,0.10,0.12,0.82)else self._msufNavBG:SetVertexColor(0.09,0.10,0.12,0.92)end
end
if self._msufNavBorder and self._msufNavBorder.SetVertexColor then if activeState then self._msufNavBorder:SetVertexColor(0.30,0.60,1.00,1.00)else if hovered then self._msufNavBorder:SetVertexColor(0.22,0.45,0.90,0.95)else self._msufNavBorder:SetVertexColor(MSUF_PILL_EDGE_R,MSUF_PILL_EDGE_G,MSUF_PILL_EDGE_B,0.80)end
end
end
end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "btn._msufApplyNavState file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:402:23"); end
local oldEnter=btn:GetScript("OnEnter");local oldLeave=btn:GetScript("OnLeave")btn:SetScript("OnEnter",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:417:103"); if self._msufApplyNavState then self:_msufApplyNavState(self._msufNavIsActive,true)end
if oldEnter then pcall(oldEnter,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:417:103"); end
)btn:SetScript("OnLeave",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:420:25"); if self._msufApplyNavState then self:_msufApplyNavState(self._msufNavIsActive,false)end
if oldLeave then pcall(oldLeave,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:420:25"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinNavButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:382:6"); end
_G.MSUF_SkinNavButton=MSUF_SkinNavButton local function MSUF_SkinDashboardButton(btn) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SkinDashboardButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:424:47"); if not btn or btn.__MSUF_DashSkinned then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinDashboardButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:424:47"); return end
btn.__MSUF_DashSkinned=true if btn.Left and btn.Left.Hide then btn.Left:Hide()end
if btn.Middle and btn.Middle.Hide then btn.Middle:Hide()end
if btn.Right and btn.Right.Hide then btn.Right:Hide()end
if btn.GetRegions then local regions={btn:GetRegions()}for i=1,#regions do local r=regions[i]if r and r.GetObjectType and r:GetObjectType()=="Texture"then local tex=r.GetTexture and r:GetTexture();local atlas=r.GetAtlas and r:GetAtlas();local isPanelArt=false if type(atlas)=="string"then if atlas:find("UI-Panel-Button",1,true)or atlas:find("UIPanelButton",1,true)then isPanelArt=true end
end
if(not isPanelArt)and type(tex)=="string"then if tex:find("UI-Panel-Button",1,true)or tex:find("UIPanelButton",1,true)or tex:find("Buttons\\UI-Panel-Button",1,true)then isPanelArt=true end
end
if isPanelArt then if r.SetAlpha then r:SetAlpha(0)end
if r.Hide then r:Hide()end
end
end
end
end
if btn.GetNormalTexture and btn.SetNormalTexture then local nt=btn:GetNormalTexture()if nt and nt.SetAlpha then nt:SetAlpha(0)end
pcall(btn.SetNormalTexture,btn,nil)end
if btn.GetPushedTexture and btn.SetPushedTexture then local pt=btn:GetPushedTexture()if pt and pt.SetAlpha then pt:SetAlpha(0)end
pcall(btn.SetPushedTexture,btn,nil)end
if btn.GetHighlightTexture and btn.SetHighlightTexture then local ht=btn:GetHighlightTexture()if ht and ht.SetAlpha then ht:SetAlpha(0)end
pcall(btn.SetHighlightTexture,btn,nil)end
if btn.GetDisabledTexture and btn.SetDisabledTexture then local dt=btn:GetDisabledTexture()if dt and dt.SetAlpha then dt:SetAlpha(0)end
pcall(btn.SetDisabledTexture,btn,nil)end
local bgHost=CreateFrame("Frame",nil,btn,"BackdropTemplate")bgHost:SetPoint("TOPLEFT",btn,"TOPLEFT",1,-1)bgHost:SetPoint("BOTTOMRIGHT",btn,"BOTTOMRIGHT",-1,1)local lvl=(btn.GetFrameLevel and btn:GetFrameLevel())or 1 if bgHost.SetFrameLevel then bgHost:SetFrameLevel((lvl>1)and(lvl-1)or 0)end
if bgHost.SetBackdrop then bgHost:SetBackdrop({bgFile="Interface/Buttons/WHITE8X8",edgeFile="Interface/Tooltips/UI-Tooltip-Border",tile=true,tileSize=16,edgeSize=12,insets={left=3,right=3,top=3,bottom=3},})bgHost:SetBackdropColor(0.08,0.09,0.11,0.92)if bgHost.SetBackdropBorderColor then bgHost:SetBackdropBorderColor(0,0,0,0.92)end
end
btn._msufDashBGFrame=bgHost local bg=btn:CreateTexture(nil,"BACKGROUND")bg:SetTexture("Interface/Buttons/WHITE8X8")bg:SetAllPoints(bgHost)bg:SetVertexColor(0.09,0.10,0.12,0.92)if btn._msufDashBGFrame and btn._msufDashBGFrame.SetBackdrop then bg:SetAlpha(0.01)end
btn._msufDashBG=bg local hover=btn:CreateTexture(nil,"HIGHLIGHT")hover:SetTexture("Interface/Buttons/WHITE8X8")hover:SetAllPoints(bg)hover:SetVertexColor(0.25,0.55,1.0,0.18)hover:Hide()btn._msufDashHover=hover local sel=btn:CreateTexture(nil,"ARTWORK")sel:SetTexture("Interface/Buttons/WHITE8X8")sel:SetAllPoints(bg)sel:SetVertexColor(0.25,0.55,1.0,0.30)sel:Hide()btn._msufDashSelected=sel local down=btn:CreateTexture(nil,"OVERLAY")down:SetTexture("Interface/Buttons/WHITE8X8")down:SetAllPoints(bg)down:SetVertexColor(0.25,0.55,1.0,0.22)down:Hide()btn._msufDashDown=down local function ApplyText(active) Perfy_Trace(Perfy_GetTime(), "Enter", "ApplyText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:450:578"); local fs=btn.GetFontString and btn:GetFontString()if fs and fs.SetTextColor then if active then fs:SetTextColor(0.92,0.96,1.00,1.00)else fs:SetTextColor(0.82,0.90,1.00,1.00)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:450:578"); end
ApplyText(false)btn._msufSetSelected=function(self,active) Perfy_Trace(Perfy_GetTime(), "Enter", "btn._msufSetSelected file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:453:37"); self._msufDashIsSelected=active and true or false if self._msufDashSelected then if self._msufDashIsSelected then self._msufDashSelected:Show()else self._msufDashSelected:Hide()end
end
ApplyText(self._msufDashIsSelected)if self._msufDashHover then if self._msufDashHover._msufHovering and not self._msufDashIsSelected then self._msufDashHover:Show()else self._msufDashHover:Hide()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "btn._msufSetSelected file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:453:37"); end
local oldEnter=btn:GetScript("OnEnter");local oldLeave=btn:GetScript("OnLeave")btn:SetScript("OnEnter",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:458:103"); if self._msufDashHover then self._msufDashHover._msufHovering=true if not self._msufDashIsSelected then self._msufDashHover:Show()end
end
if oldEnter then pcall(oldEnter,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:458:103"); end
)btn:SetScript("OnLeave",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:462:25"); if self._msufDashHover then self._msufDashHover._msufHovering=false;self._msufDashHover:Hide()end
if oldLeave then pcall(oldLeave,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:462:25"); end
)local oldDown=btn:GetScript("OnMouseDown");local oldUp=btn:GetScript("OnMouseUp")btn:SetScript("OnMouseDown",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:465:110"); if self._msufDashDown then self._msufDashDown:Show()end
if oldDown then pcall(oldDown,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:465:110"); end
)btn:SetScript("OnMouseUp",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:468:27"); if self._msufDashDown then self._msufDashDown:Hide()end
if oldUp then pcall(oldUp,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:468:27"); end
)local oldDisable=btn:GetScript("OnDisable");local oldEnable=btn:GetScript("OnEnable")btn:SetScript("OnDisable",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:471:112"); if self._msufDashBG then self._msufDashBG:SetVertexColor(0.06,0.06,0.07,0.65)end
local fs=self.GetFontString and self:GetFontString()if fs and fs.SetTextColor then fs:SetTextColor(0.55,0.60,0.70,0.85)end
if oldDisable then pcall(oldDisable,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:471:112"); end
)btn:SetScript("OnEnable",function(self,...) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:475:26"); if self._msufDashBG then self._msufDashBG:SetVertexColor(0.08,0.09,0.11,0.92)end
ApplyText(self._msufDashIsSelected)if oldEnable then pcall(oldEnable,self,...)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:475:26"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SkinDashboardButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:424:47"); end
local function MSUF_IsYellowish(r,g,b) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_IsYellowish file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:479:6"); if not r or not g or not b then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_IsYellowish file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:479:6"); return false end
if r>=0.88 and g>=0.68 and b<=0.35 and(g>=(b+0.25))then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_IsYellowish file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:479:6"); return true end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_IsYellowish file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:479:6"); return false end
local function MSUF_ApplyWhiteTextToFrame(root) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ApplyWhiteTextToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:482:6"); if not root then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyWhiteTextToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:482:6"); return end
local token=(root.__MSUF_WhiteTextToken or 0)+1 root.__MSUF_WhiteTextToken=token local useTimer=(C_Timer and C_Timer.After)and true or false;local maxNodes=useTimer and 4500 or 800;local budgetMs=useTimer and 1.0 or nil;local debugprofilestop=debugprofilestop;local stack,sp={root},1 local seen={};local nodes=0 local function ProcessChunk() Perfy_Trace(Perfy_GetTime(), "Enter", "ProcessChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:483:318"); if not root or root.__MSUF_WhiteTextToken~=token then Perfy_Trace(Perfy_GetTime(), "Leave", "ProcessChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:483:318"); return end
local t0=(budgetMs and debugprofilestop)and debugprofilestop()or nil while sp>0 do if t0 and(debugprofilestop()-t0)>=budgetMs then break end
local frame=stack[sp]stack[sp]=nil sp=sp-1 if frame and not seen[frame]then seen[frame]=true nodes=nodes+1 if nodes>maxNodes then break end
if frame.GetRegions then local regions={frame:GetRegions()}for i=1,#regions do local reg=regions[i]if reg and reg.GetObjectType and reg:GetObjectType()=="FontString"and reg.GetTextColor and reg.SetTextColor then local r,g,b=reg:GetTextColor()if MSUF_IsYellowish(r,g,b)then reg:SetTextColor(MSUF_THEME.textR,MSUF_THEME.textG,MSUF_THEME.textB,MSUF_THEME.textA)end
end
end
end
if frame.GetChildren then local children={frame:GetChildren()}for i=1,#children do local c=children[i]if c and not seen[c]then sp=sp+1 stack[sp]=c end
end
end
end
end
if sp>0 and nodes<=maxNodes and root and root.__MSUF_WhiteTextToken==token then if useTimer then C_Timer.After(0,ProcessChunk)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "ProcessChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:483:318"); end
ProcessChunk() Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyWhiteTextToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:482:6"); end
local function MSUF_ApplyFontBumpToFrame(root,bump) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ApplyFontBumpToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:499:6"); bump=tonumber(bump or 0)or 0 if bump==0 or not root then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyFontBumpToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:499:6"); return end
if root.__MSUF_FontBumpApplied==bump then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyFontBumpToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:499:6"); return end
if root.__MSUF_FontBumpInProgress then root.__MSUF_FontBumpPending=bump Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyFontBumpToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:499:6"); return end
root.__MSUF_FontBumpInProgress=true root.__MSUF_FontBumpPending=nil local queue,qIndex={root},1;local visited={}local function bumpFont(obj) Perfy_Trace(Perfy_GetTime(), "Enter", "bumpFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:502:118"); if not obj or not obj.GetFont or not obj.SetFont then Perfy_Trace(Perfy_GetTime(), "Leave", "bumpFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:502:118"); return end
local ok,font,size,flags=pcall(obj.GetFont,obj)if not ok or not font or not size then Perfy_Trace(Perfy_GetTime(), "Leave", "bumpFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:502:118"); return end
if not obj.__MSUF_FontOrig then obj.__MSUF_FontOrig={font=font,size=size,flags=flags}end
local orig=obj.__MSUF_FontOrig pcall(obj.SetFont,obj,orig.font,(orig.size or size)+bump,orig.flags) Perfy_Trace(Perfy_GetTime(), "Leave", "bumpFont file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:502:118"); end
local function enqueue(child) Perfy_Trace(Perfy_GetTime(), "Enter", "enqueue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:506:6"); if not child or visited[child]then Perfy_Trace(Perfy_GetTime(), "Leave", "enqueue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:506:6"); return end
visited[child]=true queue[#queue+1]=child Perfy_Trace(Perfy_GetTime(), "Leave", "enqueue file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:506:6"); end
visited[root]=true local function processChunk() Perfy_Trace(Perfy_GetTime(), "Enter", "processChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:508:25"); local t0=debugprofilestop();local budgetMs=6.0 while qIndex<=#queue do local frame=queue[qIndex]qIndex=qIndex+1 if frame then bumpFont(frame)if frame.EnumerateRegions then for reg in frame:EnumerateRegions()do bumpFont(reg)end
elseif frame.GetRegions then local regions={frame:GetRegions()}for i=1,#regions do bumpFont(regions[i])end
end
if frame.EnumerateChildren then for child in frame:EnumerateChildren()do enqueue(child)end
elseif frame.GetChildren then local children={frame:GetChildren()}for i=1,#children do enqueue(children[i])end
end
end
if(debugprofilestop()-t0)>budgetMs then C_Timer.After(0,processChunk) Perfy_Trace(Perfy_GetTime(), "Leave", "processChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:508:25"); return end
end
root.__MSUF_FontBumpApplied=bump root.__MSUF_FontBumpInProgress=nil local pending=root.__MSUF_FontBumpPending root.__MSUF_FontBumpPending=nil if pending and pending~=bump then C_Timer.After(0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:517:192"); if root and root.IsObjectType and root:IsObjectType("Frame")then MSUF_ApplyFontBumpToFrame(root,pending)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:517:192"); end
)end
Perfy_Trace(Perfy_GetTime(), "Leave", "processChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:508:25"); end
C_Timer.After(0,processChunk) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyFontBumpToFrame file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:499:6"); end
local function MSUF_CollectMsufScaleFrames() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_CollectMsufScaleFrames file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:522:6"); local frames,seen={},{}local function add(f) Perfy_Trace(Perfy_GetTime(), "Enter", "add file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:522:73"); if not f or seen[f]then Perfy_Trace(Perfy_GetTime(), "Leave", "add file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:522:73"); return end
if type(f)=="table"and type(f.SetScale)=="function"then seen[f]=true table.insert(frames,f)end
Perfy_Trace(Perfy_GetTime(), "Leave", "add file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:522:73"); end
if type(_G.MSUF_UnitFrames)=="table"then for _,f in pairs(_G.MSUF_UnitFrames)do add(f)end
end
add(_G.MSUF_PlayerCastbar)add(_G.MSUF_TargetCastbar)add(_G.MSUF_FocusCastbar)add(_G.MSUF_PlayerCastbarPreview)add(_G.MSUF_TargetCastbarPreview)add(_G.MSUF_FocusCastbarPreview)add(_G.MSUF_BossCastbar)add(_G.MSUF_BossCastbarPreview) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_CollectMsufScaleFrames file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:522:6"); return frames end
local function MSUF_GetSavedMsufScale() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetSavedMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:528:6"); local g=MSUF_EnsureGeneral()if not g then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetSavedMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:528:6"); return 1.0 end
local v=tonumber(g.msufUiScale)if not v then v=tonumber(g.uiScale)end
if not v then v=1.0 end
return Perfy_Trace_Passthrough("Leave", "MSUF_GetSavedMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:528:6", clamp(v,0.6,1.4)) end
local function MSUF_SetSavedMsufScale(v) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SetSavedMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:532:6"); local g=MSUF_EnsureGeneral()if not g then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetSavedMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:532:6"); return end
v=tonumber(v)or 1.0 g.msufUiScale=clamp(v,0.6,1.4) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetSavedMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:532:6"); end
local function MSUF_IsScalingDisabled() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_IsScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:534:6"); local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil return Perfy_Trace_Passthrough("Leave", "MSUF_IsScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:534:6", (g and g.disableScaling)and true or false) end
local _MSUF_pendingMsufScale;local _MSUF_pendingGlobalScale;local _MSUF_pendingDisableScaling;local _MSUF_pendingReloadOnScalingOff;local _MSUF_scaleApplyWatcher local MSUF_EnsureScaleApplyAfterCombat local function MSUF_ApplyMsufScale(scale,opts) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ApplyMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:535:207"); if MSUF_IsScalingDisabled()and not(opts and opts.ignoreDisable)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:535:207"); return end
scale=tonumber(scale)if not scale then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:535:207"); return end
scale=clamp(scale,0.6,1.4)if InCombatLockdown and InCombatLockdown()then _MSUF_pendingMsufScale=scale if MSUF_EnsureScaleApplyAfterCombat then MSUF_EnsureScaleApplyAfterCombat()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:535:207"); return end
local frames=MSUF_CollectMsufScaleFrames()for i=1,#frames do local f=frames[i]pcall(f.SetScale,f,scale)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ApplyMsufScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:535:207"); end
local UI_SCALE_1080=768/1080;local UI_SCALE_1440=768/1440;local MSUF_MIN_UISCALE_CVAR=0.64;local MSUF_MAX_UISCALE_CVAR=1.0;local _MSUF_lastGlobalCVarScale local _MSUF_lastGlobalUiParentScale local function MSUF_GetCurrentGlobalUiScale() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetCurrentGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:541:197"); if UIParent and UIParent.GetScale then return Perfy_Trace_Passthrough("Leave", "MSUF_GetCurrentGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:541:197", tonumber(UIParent:GetScale())) end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetCurrentGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:541:197"); return nil end
local function MSUF_SetCVarIfChanged(name,value) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SetCVarIfChanged file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:543:6"); if not name or value==nil then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetCVarIfChanged file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:543:6"); return end
local v=tostring(value)if C_CVar and C_CVar.GetCVar and C_CVar.SetCVar then local cur=C_CVar.GetCVar(name)if cur~=v then pcall(C_CVar.SetCVar,name,v)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetCVarIfChanged file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:543:6"); return end
if GetCVar and SetCVar then local cur=GetCVar(name)if cur~=v then pcall(SetCVar,name,v)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetCVarIfChanged file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:543:6"); end
local function MSUF_EnforceUIParentScale(scale) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnforceUIParentScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:549:6"); scale=tonumber(scale)if not scale or scale<=0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnforceUIParentScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:549:6"); return end
scale=clamp(scale,0.3,2.0)if not(UIParent and UIParent.SetScale)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnforceUIParentScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:549:6"); return end
local cur=nil if UIParent.GetScale then cur=tonumber(UIParent:GetScale())end
cur=cur or 0 if math.abs(cur-scale)>0.001 then pcall(UIParent.SetScale,UIParent,scale)end
_MSUF_lastGlobalUiParentScale=scale Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnforceUIParentScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:549:6"); end
local function MSUF_ScheduleUIParentNudges(scale) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ScheduleUIParentNudges file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:554:6"); if MSUF_IsScalingDisabled()then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ScheduleUIParentNudges file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:554:6"); return end
if not(C_Timer and C_Timer.After)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ScheduleUIParentNudges file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:554:6"); return end
scale=tonumber(scale)if not scale or scale<=0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ScheduleUIParentNudges file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:554:6"); return end
local want=scale local function nudge() Perfy_Trace(Perfy_GetTime(), "Enter", "nudge file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:557:23"); if InCombatLockdown and InCombatLockdown()then _MSUF_pendingGlobalScale=want if MSUF_EnsureScaleApplyAfterCombat then MSUF_EnsureScaleApplyAfterCombat()end
Perfy_Trace(Perfy_GetTime(), "Leave", "nudge file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:557:23"); return end
MSUF_EnforceUIParentScale(want) Perfy_Trace(Perfy_GetTime(), "Leave", "nudge file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:557:23"); end
C_Timer.After(0.05,nudge)C_Timer.After(0.25,nudge)C_Timer.After(0.60,nudge) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ScheduleUIParentNudges file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:554:6"); end
local function MSUF_SetGlobalUiScale(scale,silent,opts) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:561:6"); opts=opts or{}if MSUF_IsScalingDisabled()and not opts.ignoreDisable then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:561:6"); return end
local applyCVars=(opts.applyCVars~=false)and true or false scale=tonumber(scale)if not scale or scale<=0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:561:6"); return end
scale=clamp(scale,0.3,2.0)if InCombatLockdown and InCombatLockdown()then _MSUF_pendingGlobalScale=scale if MSUF_EnsureScaleApplyAfterCombat then MSUF_EnsureScaleApplyAfterCombat()end
if not silent then MSUF_Print("Cannot change global UI scale in combat. Will apply after combat.")end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:561:6"); return end
if applyCVars then local cvarScale=clamp(scale,MSUF_MIN_UISCALE_CVAR,MSUF_MAX_UISCALE_CVAR)if _MSUF_lastGlobalCVarScale~=cvarScale then MSUF_SetCVarIfChanged("useUiScale","1")MSUF_SetCVarIfChanged("uiScale",cvarScale)MSUF_SetCVarIfChanged("uiscale",cvarScale)_MSUF_lastGlobalCVarScale=cvarScale end
end
MSUF_EnforceUIParentScale(scale)MSUF_ScheduleUIParentNudges(scale)if not silent then local cvarScale=clamp(scale,MSUF_MIN_UISCALE_CVAR,MSUF_MAX_UISCALE_CVAR)MSUF_Print(string.format("Global UI scale set to %.3f (CVar %.3f)",scale,cvarScale))end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:561:6"); end
MSUF_EnsureScaleApplyAfterCombat=function() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureScaleApplyAfterCombat file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:570:33"); if _MSUF_scaleApplyWatcher then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureScaleApplyAfterCombat file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:570:33"); return end
if not CreateFrame then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureScaleApplyAfterCombat file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:570:33"); return end
local f=CreateFrame("Frame")_MSUF_scaleApplyWatcher=f f:RegisterEvent("PLAYER_REGEN_ENABLED")f:SetScript("OnEvent",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:572:115"); if InCombatLockdown and InCombatLockdown()then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:572:115"); return end
if _MSUF_pendingDisableScaling then _MSUF_pendingDisableScaling=nil;_MSUF_pendingMsufScale=nil _MSUF_pendingGlobalScale=nil;MSUF_ResetGlobalUiScale(true)MSUF_ApplyMsufScale(1.0,{ignoreDisable=true})elseif MSUF_IsScalingDisabled()then _MSUF_pendingMsufScale=nil;_MSUF_pendingGlobalScale=nil else local s=_MSUF_pendingMsufScale;local g=_MSUF_pendingGlobalScale;_MSUF_pendingMsufScale=nil _MSUF_pendingGlobalScale=nil if s then MSUF_ApplyMsufScale(s)end
if g then MSUF_SetGlobalUiScale(g,true)end
end
if _MSUF_pendingReloadOnScalingOff then _MSUF_pendingReloadOnScalingOff=nil if type(ReloadUI)=="function"then ReloadUI(); Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:572:115"); return end
end
if(not _MSUF_pendingDisableScaling)and(not _MSUF_pendingMsufScale)and(not _MSUF_pendingGlobalScale)then f:UnregisterEvent("PLAYER_REGEN_ENABLED");f:SetScript("OnEvent",nil)_MSUF_scaleApplyWatcher=nil end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:572:115"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureScaleApplyAfterCombat file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:570:33"); end
local function MSUF_ResetGlobalUiScale(silent) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ResetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:581:6"); if InCombatLockdown and InCombatLockdown()then if not silent then MSUF_Print("Cannot reset global UI scale in combat.")end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ResetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:581:6"); return end
MSUF_SetCVarIfChanged("useUiScale","0")MSUF_SetCVarIfChanged("uiScale","1.0")MSUF_SetCVarIfChanged("uiscale","1.0")if UIParent and UIParent.SetScale then pcall(UIParent.SetScale,UIParent,1.0)end
_MSUF_lastGlobalCVarScale=nil _MSUF_lastGlobalUiParentScale=nil if not silent then MSUF_Print("Global UI scale reset (fallback).")end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ResetGlobalUiScale file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:581:6"); end
local function MSUF_SetScalingDisabled(disable,silent) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SetScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:586:6"); local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil if not g then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:586:6"); return end
disable=disable and true or false g.disableScaling=disable if not disable then _MSUF_pendingDisableScaling=nil Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:586:6"); return end
g.globalUiScalePreset="auto"g.globalUiScaleValue=nil MSUF_SetSavedMsufScale(1.0)if InCombatLockdown and InCombatLockdown()then _MSUF_pendingDisableScaling=true if MSUF_EnsureScaleApplyAfterCombat then MSUF_EnsureScaleApplyAfterCombat()end
if not silent then MSUF_Print("MSUF scaling disabled. Will fully reset after combat.")end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:586:6"); return end
MSUF_ResetGlobalUiScale(true)MSUF_ApplyMsufScale(1.0,{ignoreDisable=true})_MSUF_pendingDisableScaling=nil _MSUF_pendingMsufScale=nil _MSUF_pendingGlobalScale=nil if not silent then MSUF_Print("MSUF scaling disabled (Blizzard handles scaling now).")end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetScalingDisabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:586:6"); end
_G.MSUF_SetScalingDisabled=MSUF_SetScalingDisabled local function MSUF_SaveGlobalPreset(preset,scale) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SaveGlobalPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:593:57"); local g=MSUF_EnsureGeneral()if not g then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SaveGlobalPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:593:57"); return end
g.globalUiScalePreset=preset g.globalUiScaleValue=scale Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SaveGlobalPreset file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:593:57"); end
local function MSUF_GetDesiredGlobalScaleFromDB() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6"); local g=MSUF_EnsureGeneral()if not g then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6"); return nil end
if g.disableScaling then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6"); return nil end
local preset=g.globalUiScalePreset if preset=="1080p"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6"); return UI_SCALE_1080 elseif preset=="1440p"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6"); return UI_SCALE_1440 elseif preset=="custom"and g.globalUiScaleValue then return Perfy_Trace_Passthrough("Leave", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6", tonumber(g.globalUiScaleValue)) end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetDesiredGlobalScaleFromDB file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:595:6"); return nil end
local MSUF_SCALE_GUARD={suppressUntil=0}local function MSUF_EnsureGlobalUiScaleApplied(silent) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureGlobalUiScaleApplied file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:599:46"); if MSUF_IsScalingDisabled()then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureGlobalUiScaleApplied file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:599:46"); return end
local now=(GetTime and GetTime())or 0 if now<(MSUF_SCALE_GUARD.suppressUntil or 0)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureGlobalUiScaleApplied file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:599:46"); return end
local want=MSUF_GetDesiredGlobalScaleFromDB()want=tonumber(want)if not want or want<=0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureGlobalUiScaleApplied file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:599:46"); return end
local have=MSUF_GetCurrentGlobalUiScale()have=tonumber(have)or want local diff=math.abs(have-want)if diff>0.001 then MSUF_SCALE_GUARD.suppressUntil=now+0.10 if InCombatLockdown and InCombatLockdown()then _MSUF_pendingGlobalScale=want if MSUF_EnsureScaleApplyAfterCombat then MSUF_EnsureScaleApplyAfterCombat()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureGlobalUiScaleApplied file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:599:46"); return end
MSUF_EnforceUIParentScale(want)if C_Timer and C_Timer.After then C_Timer.After(0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:604:81"); MSUF_EnforceUIParentScale(want) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:604:81"); end
)C_Timer.After(0.25,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:605:20"); MSUF_EnforceUIParentScale(want) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:605:20"); end
)C_Timer.After(1.0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:606:19"); MSUF_EnforceUIParentScale(want) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:606:19"); end
)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureGlobalUiScaleApplied file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:599:46"); end
local function MSUF_IsMSUFEditModeActive() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_IsMSUFEditModeActive file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:610:6"); local st=_G and _G.MSUF_EditState if type(st)=="table"and st.active~=nil then return Perfy_Trace_Passthrough("Leave", "MSUF_IsMSUFEditModeActive file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:610:6", st.active and true or false) end
if _G and type(_G.MSUF_IsEditModeActive)=="function"then local ok,res=pcall(_G.MSUF_IsEditModeActive)if ok then return Perfy_Trace_Passthrough("Leave", "MSUF_IsMSUFEditModeActive file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:610:6", res and true or false) end
end
if _G and _G.MSUF_EDITMODE_ACTIVE~=nil then return Perfy_Trace_Passthrough("Leave", "MSUF_IsMSUFEditModeActive file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:610:6", _G.MSUF_EDITMODE_ACTIVE and true or false) end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_IsMSUFEditModeActive file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:610:6"); return false end
local function MSUF_TryHookEditModeForDashboard() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_TryHookEditModeForDashboard file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:615:6"); if _G and _G.__MSUF_DashEditHooked then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_TryHookEditModeForDashboard file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:615:6"); return end
if not hooksecurefunc then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_TryHookEditModeForDashboard file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:615:6"); return end
if _G and type(_G.MSUF_SetMSUFEditModeDirect)=="function"then hooksecurefunc("MSUF_SetMSUFEditModeDirect",function(active) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:617:106"); local win=_G and _G.MSUF_StandaloneOptionsWindow;local b=win and win._msufDashEditBtn if b and b._msufSetSelected then b:_msufSetSelected(active)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:617:106"); end
)if _G then _G.__MSUF_DashEditHooked=true end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_TryHookEditModeForDashboard file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:615:6"); end
MSUF_BuildTools=function(parent,opts) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_BuildTools file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:622:16"); opts=opts or{}if not parent then return Perfy_Trace_Passthrough("Leave", "MSUF_BuildTools file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:622:16", {Refresh=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:622:85"); Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:622:85"); end
}) end
local api=parent.__MSUF_ToolsApi if api then api.opts=opts if api.Refresh then api.Refresh()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_BuildTools file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:622:16"); return api end
api={opts=opts}parent.__MSUF_ToolsApi=api local isXL=opts.xl and true or false;local seg=opts.segmented and true or false;local segGap=seg and-1 or 8;local segW=seg and(isXL and 84 or 78)or 56;local segH=seg and 22 or 20 local titleText=opts.title or"Tools";local title=UI_Text(parent,"GameFontNormal","TOPLEFT",parent,"TOPLEFT",6,-2,titleText,MSUF_SkinTitle);local globalLabel=UI_Text(parent,"GameFontHighlight","TOPLEFT",title,"BOTTOMLEFT",0,-10,"Global UI Scale",MSUF_SkinText);local globalCur=UI_Text(parent,"GameFontHighlightSmall","TOPLEFT",globalLabel,"BOTTOMLEFT",0,-6,"Current: ...",MSUF_SkinText);local btn1080,btn1440,btnAuto local presetRow=MSUF_BuildButtonRow(parent,globalCur,"TOPLEFT","BOTTOMLEFT",0,-8,{{text="1080",w=segW,h=segH,skinFn=MSUF_SkinDashboardButton,tipTitle="Global UI Scale: 1080",tipBody="Applies MSUF's global scale preset for 1080p-like setups and reloads your UI. Auto restores Blizzard scaling on reload.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:626:949"); MSUF_ShowReloadConfirm("Global UI Scale: 1080p",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:626:1007"); if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(false,true)end
MSUF_SaveGlobalPreset("1080p",UI_SCALE_1080)MSUF_SetGlobalUiScale(UI_SCALE_1080,true)ReloadUI() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:626:1007"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:626:949"); end
,},{text="1440",w=segW,h=segH,skinFn=MSUF_SkinDashboardButton,tipTitle="Global UI Scale: 1440",tipBody="Applies MSUF's global scale preset for 1440p-like setups and reloads your UI. Auto restores Blizzard scaling on reload.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:629:233"); MSUF_ShowReloadConfirm("Global UI Scale: 1440p",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:629:291"); if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(false,true)end
MSUF_SaveGlobalPreset("1440p",UI_SCALE_1440)MSUF_SetGlobalUiScale(UI_SCALE_1440,true)ReloadUI() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:629:291"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:629:233"); end
,},{text="Auto",w=segW,h=segH,skinFn=MSUF_SkinDashboardButton,tipTitle="Global UI Scale: Auto",tipBody="Stops enforcing MSUF global scale and restores your previous Blizzard UI scale.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:632:193"); MSUF_ShowReloadConfirm("Global UI Scale: Auto",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:632:250"); if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(false,true)end
MSUF_SaveGlobalPreset("auto",nil)MSUF_ResetGlobalUiScale(true)ReloadUI() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:632:250"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:632:193"); end
,},},segGap)btn1080,btn1440,btnAuto=presetRow[1],presetRow[2],presetRow[3]local msufLabel=UI_Text(parent,"GameFontHighlight","TOPLEFT",globalCur,"BOTTOMLEFT",0,-42,"UI Scale (Global)",MSUF_SkinText);local msufSlider=CreateFrame("Slider",nil,parent,"OptionsSliderTemplate")msufSlider:SetPoint("TOPLEFT",msufLabel,"BOTTOMLEFT",0,-8)msufSlider:SetMinMaxValues(10,100)msufSlider:SetValueStep(1)msufSlider:SetObeyStepOnDrag(true)if msufSlider.Text then msufSlider.Text:SetText("")end
if msufSlider.Low then msufSlider.Low:SetText("10%")end
if msufSlider.High then msufSlider.High:SetText("100%")end
local msufValue if opts.showValue then msufValue=UI_Text(parent,"GameFontHighlightSmall","LEFT",msufSlider,"RIGHT",8,0,"100%",MSUF_SkinText)end
local msufMinus,msufPlus;local pmDefs={{text="-",w=22,h=18,skinFn=MSUF_SkinDashboardButton,tipTitle="Decrease UI Scale",tipBody="Decreases the global UI scale (UIParent).",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:639:180"); if msufSlider and msufSlider.GetValue then msufSlider:SetValue((msufSlider:GetValue()or 100)-1)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:639:180"); end
,},{text="+",w=22,h=18,skinFn=MSUF_SkinDashboardButton,tipTitle="Increase UI Scale",tipBody="Increases the global UI scale (UIParent).",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:641:144"); if msufSlider and msufSlider.GetValue then msufSlider:SetValue((msufSlider:GetValue()or 100)+1)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:641:144"); end
,},}local pmRow=MSUF_BuildButtonRow(parent,msufSlider,"TOPRIGHT","BOTTOMRIGHT",0,-6,pmDefs,8)msufMinus,msufPlus=pmRow[1],pmRow[2]local resetW=120;local offW=180;local msufReset,msufOff;local row=MSUF_BuildButtonRow(parent,msufSlider,"TOPLEFT","BOTTOMLEFT",0,-6,{{text="Reset",w=resetW,h=18,skinFn=MSUF_SkinDashboardButton,tipTitle="Reset UI Scale",tipBody="Resets the global UI scale back to 100% (1.0) and marks it as Custom preset.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:643:443"); do local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil if g then g.disableScaling=false end
if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(false,true)end
end
MSUF_SaveGlobalPreset("custom",1.0)MSUF_SetGlobalUiScale(1.0,true)MSUF_SetSliderValueSilent(msufSlider,100)if api.Refresh then api.Refresh()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:643:443"); end
,},{text="Scaling OFF",w=offW,h=18,skinFn=MSUF_SkinDashboardButton,tipTitle="Disable ALL MSUF scaling",tipBody="Turns off all scaling MSUF applies (global UI scale + MSUF-only scale), then reloads your UI. Blizzard handles scaling.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:648:241"); local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil;local isDisabled=g and g.disableScaling if isDisabled then if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(false,true)else if g then g.disableScaling=false end
end
if api.Refresh then api.Refresh()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:648:241"); return end
if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(true,false)else MSUF_ResetGlobalUiScale(true)MSUF_SetSavedMsufScale(1.0)MSUF_ApplyMsufScale(1.0)if g then g.disableScaling=true g.globalUiScalePreset="auto"g.globalUiScaleValue=nil end
end
MSUF_SetSliderValueSilent(msufSlider,100)if api.Refresh then api.Refresh()end
MSUF_RequestReloadSafe() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:648:241"); end
,},},8)msufReset,msufOff=row and row[1],row and row[2]api.ui={title=title,globalCur=globalCur,btn1080=btn1080,btn1440=btn1440,btnAuto=btnAuto,msufSlider=msufSlider,msufValue=msufValue,msufMinus=msufMinus,msufPlus=msufPlus,msufReset=msufReset,msufOff=msufOff,}function api.UpdateEnabledStates() Perfy_Trace(Perfy_GetTime(), "Enter", "api.UpdateEnabledStates file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:656:259"); local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil;local disabled=g and g.disableScaling MSUF_SetEnabled(msufSlider,not disabled)MSUF_SetEnabled(msufMinus,not disabled)MSUF_SetEnabled(msufPlus,not disabled)MSUF_SetEnabled(msufReset,not disabled)return Perfy_Trace_Passthrough("Leave", "api.UpdateEnabledStates file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:656:259", disabled and true or false) end
if MSUF_AddTooltip then MSUF_AddTooltip(msufSlider,"UI Scale (Global)","Scales the entire WoW UI (UIParent). 100% = 1.0, 10% = 0.10. This sets the preset to Custom.")end
msufSlider:SetScript("OnValueChanged",function(self,value) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:658:38"); if self._msufIgnore then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:658:38"); return end
do local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil if g then g.disableScaling=false end
if _G and _G.MSUF_SetScalingDisabled then _G.MSUF_SetScalingDisabled(false,true)end
end
local pct=tonumber(value)or 100;pct=math.floor(pct+0.5)pct=clamp(pct,10,100);local scale=pct/100 MSUF_SaveGlobalPreset("custom",scale);MSUF_SetGlobalUiScale(scale,true)if msufValue and msufValue.SetText then msufValue:SetText(string.format("%d%%",pct))end
if api.Refresh then api.Refresh()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:658:38"); end
)function api.Layout() Perfy_Trace(Perfy_GetTime(), "Enter", "api.Layout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:665:1"); local pw=(parent.GetWidth and parent:GetWidth())or 0 if not pw or pw<=1 then Perfy_Trace(Perfy_GetTime(), "Leave", "api.Layout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:665:1"); return end
local avail=pw-20 if btn1080 and btn1080 .SetWidth and btn1440 and btnAuto then local wEach=math.floor((avail-16)/3)if wEach<1 then wEach=1 end
btn1080:SetWidth(wEach)btn1440:SetWidth(wEach)btnAuto:SetWidth(wEach)end
if msufSlider and msufSlider.SetWidth then local valueW=(opts.showValue and msufValue and 60)or 0;local sliderW=avail-valueW-8 if sliderW<1 then sliderW=1 end
msufSlider:SetWidth(sliderW)end
if msufOff and msufOff.SetWidth and msufReset and msufReset.GetWidth then local rw=msufReset:GetWidth()or resetW;local ow=avail-rw-8 if ow<90 then ow=90 end
if ow>260 then ow=260 end
msufOff:SetWidth(ow)end
Perfy_Trace(Perfy_GetTime(), "Leave", "api.Layout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:665:1"); end
function api.Refresh() Perfy_Trace(Perfy_GetTime(), "Enter", "api.Refresh file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:674:0"); local g=MSUF_EnsureGeneral and MSUF_EnsureGeneral()or nil;local preset=g and g.globalUiScalePreset;local disabled=g and g.disableScaling if api.UpdateEnabledStates then api.UpdateEnabledStates()end
local cur=MSUF_GetCurrentGlobalUiScale()if cur then globalCur:SetText(string.format("Current: %.3f",cur))else globalCur:SetText("Current: ?")end
local desired if disabled then desired=MSUF_GetCurrentGlobalUiScale()or 1.0 else if preset=="1080p"then desired=UI_SCALE_1080 elseif preset=="1440p"then desired=UI_SCALE_1440 elseif preset=="custom"and g and g.globalUiScaleValue then desired=tonumber(g.globalUiScaleValue)else desired=MSUF_GetCurrentGlobalUiScale()or 1.0 end
end
local pct=clamp(math.floor((tonumber(desired)or 1.0)*100+0.5),10,100)MSUF_SetSliderValueSilent(msufSlider,pct)if msufValue and msufValue.SetText then msufValue:SetText(string.format("%d%%",pct))end
if disabled then if btn1080 and btn1080 ._msufSetSelected then btn1080:_msufSetSelected(false)end
if btn1440 and btn1440 ._msufSetSelected then btn1440:_msufSetSelected(false)end
if btnAuto and btnAuto._msufSetSelected then btnAuto:_msufSetSelected(false)end
else if btn1080 and btn1080 ._msufSetSelected then btn1080:_msufSetSelected(preset=="1080p")end
    if btn1440 and btn1440 ._msufSetSelected then btn1440:_msufSetSelected(preset=="1440p")end
    if btnAuto and btnAuto._msufSetSelected then btnAuto:_msufSetSelected((preset=="auto")or(preset==nil))end
end
if MSUF_SetScalingToggleVisual then MSUF_SetScalingToggleVisual(disabled and true or false)end
if msufOff and msufOff._msufSetSelected then msufOff:_msufSetSelected(disabled and true or false)end
api.Layout() Perfy_Trace(Perfy_GetTime(), "Leave", "api.Refresh file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:674:0"); end
if not parent.__MSUF_ToolsLayoutHooked then parent.__MSUF_ToolsLayoutHooked=true parent:HookScript("OnShow",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:689:108"); if C_Timer and C_Timer.After then C_Timer.After(0,api.Layout)else api.Layout()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:689:108"); end
)parent:HookScript("OnSizeChanged",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:691:35"); if C_Timer and C_Timer.After then C_Timer.After(0,api.Layout)else api.Layout()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:691:35"); end
)end
api.Refresh() Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_BuildTools file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:622:16"); return api end
local function MSUF_ShowHideForLazy(panel,builtKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowHideForLazy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:695:6"); if not panel then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowHideForLazy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:695:6"); return end
if panel.__MSUF_LazyBuildHooked and builtKey and not panel[builtKey]then panel:Show()panel:Hide()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowHideForLazy file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:695:6"); end
local function MSUF_EnsureMainOptionsPanelBuilt() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureMainOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:698:6"); MSUF_SafeCall(EnsureDB)MSUF_SafeCall(_G and _G.MSUF_RegisterOptionsCategoryLazy)MSUF_SafeCall(_G and _G.CreateOptionsPanel)local p=_G and _G.MSUF_OptionsPanel if not p then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureMainOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:698:6"); return nil end
MSUF_ShowHideForLazy(p,"__MSUF_FullBuilt") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureMainOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:698:6"); return p end
local function MSUF_GetMainSettingsCategory() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetMainSettingsCategory file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:700:6"); return Perfy_Trace_Passthrough("Leave", "MSUF_GetMainSettingsCategory file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:700:6", (_G and _G.MSUF_SettingsCategory)or(ns and ns.MSUF_MainCategory)) end
local function MSUF_EnsureMainSettingsCategory() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureMainSettingsCategory file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:701:6"); local cat=MSUF_GetMainSettingsCategory()if not cat then MSUF_SafeCall(_G and _G.MSUF_RegisterOptionsCategoryLazy)cat=MSUF_GetMainSettingsCategory()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureMainSettingsCategory file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:701:6"); return cat end
local SETTINGS_PANEL_DEFS={colors={full="MSUF_RegisterColorsOptions_Full",fallback="MSUF_RegisterColorsOptions",globals={"MSUF_ColorsPanel","MSUF_ColorsOptionsPanel"},builtKey="__MSUF_ColorsBuilt",},auras2={full="MSUF_RegisterAurasOptions_Full",fallback="MSUF_RegisterAurasOptions",globals={"MSUF_AurasPanel","MSUF_AurasOptionsPanel"},builtKey="__MSUF_AurasBuilt",},gameplay={full="MSUF_RegisterGameplayOptions_Full",fallback="MSUF_RegisterGameplayOptions",globals={"MSUF_GameplayPanel","MSUF_GameplayOptionsPanel"},builtKey="__MSUF_GameplayBuilt",},}local function MSUF_FindFirstGlobal(nameList) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_FindFirstGlobal file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:703:557"); if not _G or type(nameList)~="table"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_FindFirstGlobal file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:703:557"); return nil end
for i=1,#nameList do local k=nameList[i];local obj=_G[k]if obj then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_FindFirstGlobal file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:703:557"); return obj end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_FindFirstGlobal file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:703:557"); return nil end
local function MSUF_EnsureSubOptionsPanelBuilt(kind) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureSubOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:707:6"); local def=SETTINGS_PANEL_DEFS[kind]if not def then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureSubOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:707:6"); return nil end
local cat=MSUF_EnsureMainSettingsCategory()if not cat then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureSubOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:707:6"); return nil end
if ns then local fn=ns[def.full]if type(fn)=="function"then pcall(fn,cat)else fn=ns[def.fallback]if type(fn)=="function"then pcall(fn,cat)end
end
end
local p=MSUF_FindFirstGlobal(def.globals)MSUF_ShowHideForLazy(p,def.builtKey) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureSubOptionsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:707:6"); return p end
local function MSUF_EnsureColorsPanelBuilt() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureColorsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:713:6"); return Perfy_Trace_Passthrough("Leave", "MSUF_EnsureColorsPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:713:6", MSUF_EnsureSubOptionsPanelBuilt("colors")) end
local function MSUF_EnsureAuras2PanelBuilt() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureAuras2PanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:714:6"); return Perfy_Trace_Passthrough("Leave", "MSUF_EnsureAuras2PanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:714:6", MSUF_EnsureSubOptionsPanelBuilt("auras2")) end
local function MSUF_EnsureGameplayPanelBuilt() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureGameplayPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:715:6"); return Perfy_Trace_Passthrough("Leave", "MSUF_EnsureGameplayPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:715:6", MSUF_EnsureSubOptionsPanelBuilt("gameplay")) end
local function MSUF_EnsureModulesPanelBuilt() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_EnsureModulesPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:716:6"); if _G.MSUF_ModulesMirrorPanel and _G.MSUF_ModulesMirrorPanel.__MSUF_ModulesBuilt then return Perfy_Trace_Passthrough("Leave", "MSUF_EnsureModulesPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:716:6", _G.MSUF_ModulesMirrorPanel) end
local p=CreateFrame("Frame","MSUF_ModulesMirrorPanel",UIParent)_G.MSUF_ModulesMirrorPanel=p p.__MSUF_ModulesBuilt=true p.__MSUF_MirrorNoRestoreShow=true p:SetPoint("TOPLEFT",0,0)p:SetPoint("BOTTOMRIGHT",0,0)if p.Hide then p:Hide()end
local title=p:CreateFontString(nil,"OVERLAY","GameFontNormalLarge")title:SetPoint("TOPLEFT",12,-12)title:SetText("Modules")local sub=p:CreateFontString(nil,"OVERLAY","GameFontNormal")sub:SetPoint("TOPLEFT",title,"BOTTOMLEFT",0,-6)sub:SetText("Optional MSUF modules and UI styling (MSUF only).")if type(_G.MSUF_ApplyMidnightBackdrop)=="function"then pcall(_G.MSUF_ApplyMidnightBackdrop,p,0.96)end
if type(_G.MSUF_SkinTitle)=="function"then pcall(_G.MSUF_SkinTitle,title)end
if type(_G.MSUF_SkinMuted)=="function"then pcall(_G.MSUF_SkinMuted,sub)end
local cb=CreateFrame("CheckButton",nil,p,"UICheckButtonTemplate")cb:SetPoint("TOPLEFT",sub,"BOTTOMLEFT",0,-14)if cb.Text then cb.Text:SetText("Enable MSUF Style")if type(_G.MSUF_SkinText)=="function"then pcall(_G.MSUF_SkinText,cb.Text)end
end
local note=p:CreateFontString(nil,"OVERLAY","GameFontDisableSmall")note:SetPoint("TOPLEFT",cb,"BOTTOMLEFT",28,-6)note:SetText("Disabling may require /reload to fully remove existing styling.")if type(_G.MSUF_SkinMuted)=="function"then pcall(_G.MSUF_SkinMuted,note)end
local function GetEnabled() Perfy_Trace(Perfy_GetTime(), "Enter", "GetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:724:6"); if type(_G.MSUF_StyleIsEnabled)=="function"then local ok,v=pcall(_G.MSUF_StyleIsEnabled)if ok then return Perfy_Trace_Passthrough("Leave", "GetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:724:6", v and true or false) end
end
if _G.MSUF_DB and _G.MSUF_DB.general then return Perfy_Trace_Passthrough("Leave", "GetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:724:6", _G.MSUF_DB.general.styleEnabled~=false) end
Perfy_Trace(Perfy_GetTime(), "Leave", "GetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:724:6"); return true end
local function SetEnabled(v) Perfy_Trace(Perfy_GetTime(), "Enter", "SetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:728:6"); if type(_G.MSUF_SetStyleEnabled)=="function"then pcall(_G.MSUF_SetStyleEnabled,v and true or false)else if _G.MSUF_DB and _G.MSUF_DB.general then _G.MSUF_DB.general.styleEnabled=v and true or false end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "SetEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:728:6"); end
cb:SetScript("OnShow",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:731:22"); cb:SetChecked(GetEnabled()) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:731:22"); end
)cb:SetScript("OnClick",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:732:24"); SetEnabled(self:GetChecked()) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:732:24"); end
)local rb=CreateFrame("CheckButton",nil,p,"UICheckButtonTemplate")rb:SetPoint("TOPLEFT",note,"BOTTOMLEFT",-28,-12)if rb.Text then rb.Text:SetText("Rounded unitframes")if type(_G.MSUF_SkinText)=="function"then pcall(_G.MSUF_SkinText,rb.Text)end
end
rb.tooltipText="Round MSUF unitframes by masking HP/Power/Absorb bars and backgrounds with the superellipse mask."local function GetRoundedEnabled() Perfy_Trace(Perfy_GetTime(), "Enter", "GetRoundedEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:735:120"); if _G.MSUF_DB and _G.MSUF_DB.general then return Perfy_Trace_Passthrough("Leave", "GetRoundedEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:735:120", _G.MSUF_DB.general.roundedUnitframes==true) end
Perfy_Trace(Perfy_GetTime(), "Leave", "GetRoundedEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:735:120"); return false end
local function SetRoundedEnabled(v) Perfy_Trace(Perfy_GetTime(), "Enter", "SetRoundedEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:737:6"); if _G.MSUF_DB and _G.MSUF_DB.general then _G.MSUF_DB.general.roundedUnitframes=v and true or false end
if type(_G.MSUF_ApplyModules)=="function"then pcall(_G.MSUF_ApplyModules)end
Perfy_Trace(Perfy_GetTime(), "Leave", "SetRoundedEnabled file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:737:6"); end
rb:SetScript("OnShow",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:740:22"); rb:SetChecked(GetRoundedEnabled()) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:740:22"); end
)rb:SetScript("OnClick",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:741:24"); SetRoundedEnabled(self:GetChecked()) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:741:24"); end
) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_EnsureModulesPanelBuilt file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:716:6"); return p end
local function MSUF_SelectMainOptionsKey(key) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SelectMainOptionsKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:743:6"); local p=_G and _G.MSUF_OptionsPanel if not p then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SelectMainOptionsKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:743:6"); return end
if type(MSUF_GetTabButtonHelpers)~="function"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SelectMainOptionsKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:743:6"); return end
local _,setKey=MSUF_GetTabButtonHelpers(p)if type(setKey)=="function"then setKey(key)if p.LoadFromDB then pcall(p.LoadFromDB,p)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SelectMainOptionsKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:743:6"); end
local function MSUF_SelectCastbarSubPage(unitKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SelectCastbarSubPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:748:6"); if type(_G and _G.MSUF_SetActiveCastbarSubPage)=="function"then pcall(_G.MSUF_SetActiveCastbarSubPage,unitKey)elseif type(MSUF_SetActiveCastbarSubPage)=="function"then pcall(MSUF_SetActiveCastbarSubPage,unitKey)end
local p=_G and _G.MSUF_OptionsPanel if p and p.LoadFromDB then pcall(p.LoadFromDB,p)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SelectCastbarSubPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:748:6"); end
local function MSUF_MirrorSelectMain(subkey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_MirrorSelectMain file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:751:6"); if not subkey then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSelectMain file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:751:6"); return end
if type(subkey)=="table"then local tab=subkey.tab or subkey.key or subkey.page;if tab then MSUF_SelectMainOptionsKey(tab)end
local castSub=subkey.castbarSub or subkey.castbar or subkey.sub;if tab=="castbar"and castSub then MSUF_SelectCastbarSubPage(castSub)end
elseif type(subkey)=="string"then MSUF_SelectMainOptionsKey(subkey)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSelectMain file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:751:6"); end
-- === Page Registry (MIRROR_PAGES) ===

local MIRROR_PAGES={home={title="Midnight Simple Unitframes (Version 1.9b3)",nav="Dashboard",build=nil},main={title="MSUF Options",nav="Options",build=MSUF_EnsureMainOptionsPanelBuilt,select=MSUF_MirrorSelectMain},uf_player={title="MSUF Player",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:758:291"); MSUF_SelectMainOptionsKey("player") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:758:291"); end
},uf_target={title="MSUF Target",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:759:79"); MSUF_SelectMainOptionsKey("target") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:759:79"); end
},uf_targettarget={title="MSUF Target of Target",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:760:95"); MSUF_SelectMainOptionsKey("targettarget") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:760:95"); end
},uf_focus={title="MSUF Focus",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:761:77"); MSUF_SelectMainOptionsKey("focus") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:761:77"); end
},uf_boss={title="MSUF Boss Frames",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:762:82"); MSUF_SelectMainOptionsKey("boss") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:762:82"); end
},uf_pet={title="MSUF Pet",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:763:73"); MSUF_SelectMainOptionsKey("pet") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:763:73"); end
},opt_bars={title="MSUF Bars",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:764:76"); MSUF_SelectMainOptionsKey("bars") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:764:76"); end
},opt_fonts={title="MSUF Fonts",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:765:78"); MSUF_SelectMainOptionsKey("fonts") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:765:78"); end
},opt_auras={title="MSUF Auras",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:766:78"); MSUF_SelectMainOptionsKey("auras") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:766:78"); end
},auras2={title="MSUF Auras 2.0",build=MSUF_EnsureAuras2PanelBuilt},opt_castbar={title="MSUF Castbar",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:767:148"); MSUF_SelectMainOptionsKey("castbar") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:767:148"); end
},opt_misc={title="MSUF Miscellaneous",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:768:85"); MSUF_SelectMainOptionsKey("misc") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:768:85"); end
},opt_colors={title="MSUF Colors",build=MSUF_EnsureColorsPanelBuilt},castbar={title="MSUF Castbar",build=MSUF_EnsureMainOptionsPanelBuilt,select=function(subkey) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:769:145"); MSUF_SelectMainOptionsKey("castbar");if subkey and subkey~=""then MSUF_SelectCastbarSubPage(subkey)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:769:145"); end
},profiles={title="MSUF Profiles",build=MSUF_EnsureMainOptionsPanelBuilt,select=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:771:80"); MSUF_SelectMainOptionsKey("profiles") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:771:80"); end
},colors={title="MSUF Colors",build=MSUF_EnsureColorsPanelBuilt},gameplay={title="MSUF Gameplay",build=MSUF_EnsureGameplayPanelBuilt},modules={title="MSUF Modules",build=MSUF_EnsureModulesPanelBuilt}}local function MSUF_GetMirrorPageInfo(key) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetMirrorPageInfo file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:772:206"); return Perfy_Trace_Passthrough("Leave", "MSUF_GetMirrorPageInfo file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:772:206", MIRROR_PAGES and key and MIRROR_PAGES[key]or nil) end
local function MSUF_NormalizeMirrorKey(key,allowHome) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_NormalizeMirrorKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:773:6"); key=key or(allowHome and"home"or"main")if allowHome and key=="home"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_NormalizeMirrorKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:773:6"); return"home"end
local info=MSUF_GetMirrorPageInfo(key)if info and key~="home"then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_NormalizeMirrorKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:773:6"); return key end
return Perfy_Trace_Passthrough("Leave", "MSUF_NormalizeMirrorKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:773:6", allowHome and"home"or"main") end
local function MSUF_GetPanelForKey(key) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_GetPanelForKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:776:6"); key=MSUF_NormalizeMirrorKey(key,false)local info=MSUF_GetMirrorPageInfo(key)or MSUF_GetMirrorPageInfo("main");local builder=info and info.build if type(builder)=="function"then return Perfy_Trace_Passthrough("Leave", "MSUF_GetPanelForKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:776:6", builder()) end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_GetPanelForKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:776:6"); return nil end
local MSUF_MirrorSetHeaderHidden local function MSUF_DetachMirroredPanel(panel) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_DetachMirroredPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:778:39"); if not panel or not panel.__MSUF_MirrorActive then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_DetachMirroredPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:778:39"); return end
MSUF_MirrorSetHeaderHidden(panel,false)if panel.__MSUF_MirrorState then MSUF_RestorePanelState(panel,panel.__MSUF_MirrorState)end
local orig=panel.__MSUF_MirrorOrig if orig then if panel.Hide then pcall(panel.Hide,panel)end
if panel.SetScale and orig.scale then pcall(panel.SetScale,panel,orig.scale)end
if panel.SetFrameStrata and orig.strata then pcall(panel.SetFrameStrata,panel,orig.strata)end
if panel.SetFrameLevel and orig.level then pcall(panel.SetFrameLevel,panel,orig.level)end
if panel.SetParent and orig.parent then pcall(panel.SetParent,panel,orig.parent)end
if panel.ClearAllPoints then pcall(panel.ClearAllPoints,panel)end
if panel.SetPoint and orig.points and#orig.points>0 then for i=1,#orig.points do local pt=orig.points[i]if pt and pt[1]then pcall(panel.SetPoint,panel,pt[1],pt[2],pt[3],pt[4],pt[5])end
end
end
if orig.shown and not panel.__MSUF_MirrorNoRestoreShow and panel.Show then pcall(panel.Show,panel)end
else if panel.Hide then pcall(panel.Hide,panel)end
end
panel.__MSUF_MirrorActive=nil panel.__MSUF_MirrorState=nil Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_DetachMirroredPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:778:39"); end
MSUF_MirrorSetHeaderHidden=function(panel,hidden) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_MirrorSetHeaderHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:793:27"); if not panel then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSetHeaderHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:793:27"); return end
if hidden then if panel.__MSUF_MirrorHiddenHeader then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSetHeaderHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:793:27"); return end
panel.__MSUF_MirrorHiddenHeader={}local targets=panel.__MSUF_MirrorHeaderTargets if type(targets)=="table"and#targets>0 then for i=1,#targets do local r=targets[i]if r then panel.__MSUF_MirrorHiddenHeader[r]=(r.IsShown and r:IsShown())and 1 or 0 if r.Hide then r:Hide()end
end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSetHeaderHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:793:27"); return end
if type(targets)~="table"then targets={}panel.__MSUF_MirrorHeaderTargets=targets end
if panel.__MSUF_MirrorHeaderScanToken then panel.__MSUF_MirrorHeaderScanToken=nil panel.__MSUF_MirrorHeaderScanState=nil end
local function IsHeaderText(t) Perfy_Trace(Perfy_GetTime(), "Enter", "IsHeaderText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:801:6"); if type(t)~="string"or t==""then Perfy_Trace(Perfy_GetTime(), "Leave", "IsHeaderText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:801:6"); return false end
local tl=string.lower(t)return Perfy_Trace_Passthrough("Leave", "IsHeaderText file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:801:6", string.find(tl,"midnight simple unit frames",1,true)or string.find(tl,"beta version",1,true)or string.find(tl,"early version",1,true)or string.find(tl,"thank you for using",1,true)) end
local function ScanChunk() Perfy_Trace(Perfy_GetTime(), "Enter", "ScanChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:803:6"); if not panel.__MSUF_MirrorHiddenHeader then panel.__MSUF_MirrorHeaderScanToken=nil panel.__MSUF_MirrorHeaderScanState=nil Perfy_Trace(Perfy_GetTime(), "Leave", "ScanChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:803:6"); return end
local token=panel.__MSUF_MirrorHeaderScanToken if not token then Perfy_Trace(Perfy_GetTime(), "Leave", "ScanChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:803:6"); return end
local st=panel.__MSUF_MirrorHeaderScanState if type(st)~="table"then st={stack={panel},sp=1,nodes=0,maxNodes=450,}panel.__MSUF_MirrorHeaderScanState=st end
local debugprofilestop=debugprofilestop;local t0=debugprofilestop and debugprofilestop()or nil;local budgetMs=1.0;local stack=st.stack;local sp=st.sp or 0 local nodes=st.nodes or 0;local maxNodes=st.maxNodes or 450 while sp>0 do if t0 and(debugprofilestop()-t0)>=budgetMs then break end
local frame=stack[sp]stack[sp]=nil sp=sp-1 if frame then nodes=nodes+1 if nodes>maxNodes then break end
if frame.GetRegions then local regions={frame:GetRegions()}for i=1,#regions do local r=regions[i]if r and r.GetObjectType and r:GetObjectType()=="FontString"and r.GetText then local t=r:GetText()if IsHeaderText(t)then panel.__MSUF_MirrorHiddenHeader[r]=(r.IsShown and r:IsShown())and 1 or 0 if r.Hide then r:Hide()end
targets[#targets+1]=r if#targets>=6 then nodes=maxNodes+1 break end
end
end
end
end
if frame.GetChildren then local children={frame:GetChildren()}for i=1,#children do local c=children[i]if c then sp=sp+1 stack[sp]=c end
end
end
end
end
st.sp=sp st.nodes=nodes if sp>0 and nodes<=maxNodes and panel.__MSUF_MirrorHiddenHeader and panel.__MSUF_MirrorHeaderScanToken==token then if C_Timer and C_Timer.After then C_Timer.After(0,ScanChunk)end
Perfy_Trace(Perfy_GetTime(), "Leave", "ScanChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:803:6"); return end
panel.__MSUF_MirrorHeaderScanToken=nil panel.__MSUF_MirrorHeaderScanState=nil Perfy_Trace(Perfy_GetTime(), "Leave", "ScanChunk file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:803:6"); end
panel.__MSUF_MirrorHeaderScanToken=tostring(GetTime and GetTime()or math.random())if C_Timer and C_Timer.After then C_Timer.After(0,ScanChunk)else ScanChunk()end
else local st=panel.__MSUF_MirrorHiddenHeader if not st then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSetHeaderHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:793:27"); return end
    panel.__MSUF_MirrorHeaderScanToken=nil panel.__MSUF_MirrorHeaderScanState=nil panel.__MSUF_MirrorHiddenHeader=nil for r,wasShown in pairs(st)do if r and wasShown==1 then if r.Show then r:Show()end
end
end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_MirrorSetHeaderHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:793:27"); end
local function MSUF_AttachMirroredPanel(panel,parent,activeKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_AttachMirroredPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:829:6"); if not panel or not parent then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_AttachMirroredPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:829:6"); return end
if not panel.__MSUF_MirrorOrig then local orig={}orig.parent=(panel.GetParent and panel:GetParent())or nil orig.scale=(panel.GetScale and panel:GetScale())or 1 orig.strata=(panel.GetFrameStrata and panel:GetFrameStrata())or nil orig.level=(panel.GetFrameLevel and panel:GetFrameLevel())or nil if panel.__MSUF_MirrorNoRestoreShow then orig.shown=false else orig.shown=(panel.IsShown and panel:IsShown())and true or false end
orig.points={}if panel.GetNumPoints and panel.GetPoint then local n=panel:GetNumPoints()or 0 for i=1,n do local p,relTo,relPoint,xOfs,yOfs=panel:GetPoint(i)orig.points[i]={p,relTo,relPoint,xOfs,yOfs}end
end
panel.__MSUF_MirrorOrig=orig end
if not panel.__MSUF_MirrorActive then panel.__MSUF_MirrorState=MSUF_CapturePanelState(panel)panel.__MSUF_MirrorActive=true end
if panel.SetParent then pcall(panel.SetParent,panel,parent)end
if panel.ClearAllPoints then pcall(panel.ClearAllPoints,panel)end
if panel.SetPoint then local cropY=0 if panel==(_G and _G.MSUF_OptionsPanel)then local deep=(type(activeKey)=="string"and activeKey~="main")and true or false cropY=deep and MSUF_MIRROR_DEEPLINK_CROP_Y or MSUF_MIRROR_MAIN_CROP_Y MSUF_MirrorSetHeaderHidden(panel,true)end
pcall(panel.SetPoint,panel,"TOPLEFT",parent,"TOPLEFT",0,cropY)pcall(panel.SetPoint,panel,"BOTTOMRIGHT",parent,"BOTTOMRIGHT",0,0)end
if panel.SetScale then pcall(panel.SetScale,panel,MIRROR_PANEL_SCALE)end
if panel.SetFrameStrata then pcall(panel.SetFrameStrata,panel,"DIALOG")end
if panel.Show then pcall(panel.Show,panel)end
if not panel.__MSUF_MirrorWhiteHooked and panel.HookScript then panel.__MSUF_MirrorWhiteHooked=true panel:HookScript("OnShow",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:842:126"); MSUF_ApplyWhiteTextToFrame(panel);MSUF_ApplyFontBumpToFrame(panel,MIRRORED_PANEL_FONT_BUMP)MSUF_ApplyMidnightControlsToFrame(panel) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:842:126"); end
)end
if panel.LoadFromDB then pcall(panel.LoadFromDB,panel)elseif panel.Refresh then pcall(panel.Refresh,panel)end
MSUF_ApplyWhiteTextToFrame(panel)MSUF_ApplyFontBumpToFrame(panel,MIRRORED_PANEL_FONT_BUMP)MSUF_ApplyMidnightControlsToFrame(panel) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_AttachMirroredPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:829:6"); end
local function MSUF_Standalone_SetCastbarTopButtonsHidden(hidden) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Standalone_SetCastbarTopButtonsHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:846:6"); local panel=_G and _G.MSUF_OptionsPanel;local editBtn=_G and _G["MSUF_CastbarEditModeButton"];local focusBtn=_G and _G["MSUF_CastbarFocusButton"]local function Capture(btn) Perfy_Trace(Perfy_GetTime(), "Enter", "Capture file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:846:216"); if not btn or btn.__msufStandaloneAnchorBackup then Perfy_Trace(Perfy_GetTime(), "Leave", "Capture file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:846:216"); return end
local st={}st.parent=(btn.GetParent and btn:GetParent())or nil st.shown=(btn.IsShown and btn:IsShown())and true or false st.points={}if btn.GetNumPoints and btn.GetPoint then local n=btn:GetNumPoints()or 0 for i=1,n do local pnt,relTo,relPoint,xOfs,yOfs=btn:GetPoint(i)st.points[i]={pnt,relTo,relPoint,xOfs,yOfs}end
end
btn.__msufStandaloneAnchorBackup=st Perfy_Trace(Perfy_GetTime(), "Leave", "Capture file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:846:216"); end
local function Restore(btn) Perfy_Trace(Perfy_GetTime(), "Enter", "Restore file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:850:6"); if not btn then Perfy_Trace(Perfy_GetTime(), "Leave", "Restore file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:850:6"); return end
local st=btn.__msufStandaloneAnchorBackup if not st then Perfy_Trace(Perfy_GetTime(), "Leave", "Restore file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:850:6"); return end
btn.__msufStandaloneAnchorBackup=nil if st.parent and btn.SetParent then pcall(btn.SetParent,btn,st.parent)end
if btn.ClearAllPoints then pcall(btn.ClearAllPoints,btn)end
if btn.SetPoint and st.points then for i=1,#st.points do local pt=st.points[i]if pt and pt[1]then pcall(btn.SetPoint,btn,pt[1],pt[2],pt[3],pt[4],pt[5])end
end
end
if st.shown then if btn.Show then pcall(btn.Show,btn)end
else if btn.Hide then pcall(btn.Hide,btn)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "Restore file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:850:6"); end
if hidden then Capture(focusBtn)Capture(editBtn)if panel and focusBtn and focusBtn.ClearAllPoints and focusBtn.SetPoint then if focusBtn.SetParent then pcall(focusBtn.SetParent,focusBtn,panel)end
if focusBtn.Show then pcall(focusBtn.Show,focusBtn)end
pcall(focusBtn.ClearAllPoints,focusBtn)pcall(focusBtn.SetPoint,focusBtn,"TOPLEFT",panel,"TOPLEFT",16,-150)end
if editBtn and editBtn.Hide then pcall(editBtn.Hide,editBtn)end
else Restore(editBtn)Restore(focusBtn)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_SetCastbarTopButtonsHidden file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:846:6"); end
local function MSUF_IsCastbarKey(k) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_IsCastbarKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:867:6"); return Perfy_Trace_Passthrough("Leave", "MSUF_IsCastbarKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:867:6", k=="castbar"or k=="opt_castbar") end
local function MSUF_Standalone_UpdateTitle(activeKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Standalone_UpdateTitle file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:868:6"); if not(S.win and S.win._msufTitleFS and S.win._msufTitleFS.SetText)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_UpdateTitle file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:868:6"); return end
if activeKey=="home"then S.win._msufTitleFS:SetText("MSUF Menu") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_UpdateTitle file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:868:6"); return end
local info=MSUF_GetMirrorPageInfo(activeKey)S.win._msufTitleFS:SetText((info and info.title)or"MSUF Menu") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_UpdateTitle file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:868:6"); end
local function MSUF_Standalone_UpdateNav(activeKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Standalone_UpdateNav file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:871:6"); if not(S.win and S.win._msufNavButtons)then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_UpdateNav file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:871:6"); return end
local buttons=S.win._msufNavButtons;local highlightKey=activeKey do local b=buttons and buttons[activeKey];local visible=b and b.IsShown and b:IsShown()if not visible then if type(activeKey)=="string"then if activeKey:match("^uf_")then highlightKey="hdr_unitframes"elseif activeKey:match("^opt_")then highlightKey="hdr_options"elseif activeKey=="modules"then highlightKey="hdr_modules"end
end
end
end
for k,btn in pairs(buttons)do if btn then if btn.SetEnabled then btn:SetEnabled(true)end
btn._msufNavIsActive=(k==highlightKey)if btn._msufApplyNavState then btn:_msufApplyNavState(btn._msufNavIsActive,false)end
end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_UpdateNav file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:871:6"); end
local function MSUF_Standalone_ApplySelection(key,subkey,isCastbarKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Standalone_ApplySelection file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:881:6"); local info=MSUF_GetMirrorPageInfo(key);local sel=info and info.select;local wantSub=subkey if wantSub==nil and S and S.mirror then wantSub=S.mirror.pendingSubKey S.mirror.pendingSubKey=nil end
if S and S.mirror then if isCastbarKey and type(wantSub)=="string"and wantSub~=""then S.mirror.currentSubKey=wantSub elseif not isCastbarKey then S.mirror.currentSubKey=nil end
end
if type(sel)=="function"then if C_Timer and C_Timer.After then C_Timer.After(0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:884:79"); pcall(sel,wantSub) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:884:79"); end
)C_Timer.After(0.05,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:885:20"); pcall(sel,wantSub) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:885:20"); end
)else pcall(sel,wantSub)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_ApplySelection file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:881:6"); end
local function MSUF_Standalone_AttachMirrorPanel(key) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Standalone_AttachMirrorPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:889:6"); local panel=MSUF_GetPanelForKey(key)if panel and S.mirror and S.mirror.host then MSUF_AttachMirroredPanel(panel,S.mirror.host,key)MSUF_ApplyWhiteTextToFrame(panel)MSUF_ApplyFontBumpToFrame(panel,MIRRORED_PANEL_FONT_BUMP)if C_Timer and C_Timer.After then C_Timer.After(0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:889:323"); if panel and panel.__MSUF_MirrorActive then MSUF_ApplyWhiteTextToFrame(panel);MSUF_ApplyFontBumpToFrame(panel,MIRRORED_PANEL_FONT_BUMP)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:889:323"); end
)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_AttachMirrorPanel file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:889:6"); return panel end
local function MSUF_Standalone_AfterAttachFixups(key,isCastbarKey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_Standalone_AfterAttachFixups file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:894:6"); if not isCastbarKey then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_AfterAttachFixups file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:894:6"); return end
MSUF_Standalone_SetCastbarTopButtonsHidden(true)if C_Timer and C_Timer.After then C_Timer.After(0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:895:98"); MSUF_Standalone_SetCastbarTopButtonsHidden(true) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:895:98"); end
)C_Timer.After(0.05,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:896:20"); MSUF_Standalone_SetCastbarTopButtonsHidden(true) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:896:20"); end
)C_Timer.After(0.15,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:897:20"); MSUF_Standalone_SetCastbarTopButtonsHidden(true) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:897:20"); end
)C_Timer.After(0.30,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:898:20"); MSUF_Standalone_SetCastbarTopButtonsHidden(true) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:898:20"); end
)end
local p=S and S.mirror and S.mirror.currentPanel if p and p.HookScript and not p.__MSUF_FocusKickResizeHooked then p.__MSUF_FocusKickResizeHooked=true p:HookScript("OnSizeChanged",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:900:180"); if S and S.mirror and MSUF_IsCastbarKey(S.mirror.currentKey)then local function repin() Perfy_Trace(Perfy_GetTime(), "Enter", "repin file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:900:261"); if S and S.mirror and MSUF_IsCastbarKey(S.mirror.currentKey)then MSUF_Standalone_SetCastbarTopButtonsHidden(true)end
Perfy_Trace(Perfy_GetTime(), "Leave", "repin file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:900:261"); end
if C_Timer and C_Timer.After then C_Timer.After(0,repin);C_Timer.After(0.05,repin)C_Timer.After(0.15,repin);C_Timer.After(0.30,repin)else repin()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:900:180"); end
)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_Standalone_AfterAttachFixups file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:894:6"); end
local function MSUF_SwitchMirrorPage(key,subkey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SwitchMirrorPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:907:6"); key=MSUF_NormalizeMirrorKey(key,true)if key=="home"then if S.mirror and MSUF_IsCastbarKey(S.mirror.currentKey)and not MSUF_IsCastbarKey(key)then MSUF_Standalone_SetCastbarTopButtonsHidden(false)end
if S.mirror.currentPanel then MSUF_DetachMirroredPanel(S.mirror.currentPanel)S.mirror.currentPanel=nil end
S.mirror.currentKey="home"if S.mirror.homePanel then if S.mirror.homePanel.Show then S.mirror.homePanel:Show()end
MSUF_UpdateHomePanel(S.mirror.homePanel)end
MSUF_Standalone_UpdateTitle("home")MSUF_Standalone_UpdateNav("home") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SwitchMirrorPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:907:6"); return end
if S.mirror.homePanel and S.mirror.homePanel.Hide then S.mirror.homePanel:Hide()end
local isCastbarKey=MSUF_IsCastbarKey(key)if S.mirror.currentKey==key and S.mirror.currentPanel and S.mirror.currentPanel.IsShown and S.mirror.currentPanel:IsShown()then MSUF_Standalone_ApplySelection(key,subkey,isCastbarKey)MSUF_Standalone_UpdateTitle(key)MSUF_Standalone_UpdateNav(key) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SwitchMirrorPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:907:6"); return end
if S.mirror and MSUF_IsCastbarKey(S.mirror.currentKey)and not isCastbarKey then MSUF_Standalone_SetCastbarTopButtonsHidden(false)end
if S.mirror.currentPanel then MSUF_DetachMirroredPanel(S.mirror.currentPanel)S.mirror.currentPanel=nil end
S.mirror.currentKey=key S.mirror.currentPanel=MSUF_Standalone_AttachMirrorPanel(key)MSUF_Standalone_ApplySelection(key,subkey,isCastbarKey)MSUF_Standalone_AfterAttachFixups(key,isCastbarKey)MSUF_Standalone_UpdateTitle(key)MSUF_Standalone_UpdateNav(key) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SwitchMirrorPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:907:6"); end
local function MSUF_BuildMirrorNavButtons(navParent,btnW,btnH) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_BuildMirrorNavButtons file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:917:6"); if not navParent then return Perfy_Trace_Passthrough("Leave", "MSUF_BuildMirrorNavButtons file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:917:6", {}) end
btnH=btnH or 24 local padL=2;local padT=10;local padB=8;local gap=8;local indent=10 local extraRight=42;local railW=navParent.GetWidth and navParent:GetWidth()or 150 btnW=btnW or math.max(110,railW-(padL*2)-extraRight)local out={};local headers=navParent._msufTreeHeaders or{}navParent._msufTreeHeaders=headers local hasTitle=not navParent._msufSkipNavTitle;local title,sub if hasTitle and not navParent._msufNavTitle then title=navParent:CreateFontString(nil,"OVERLAY","GameFontNormal")title:SetPoint("TOPLEFT",navParent,"TOPLEFT",padL,-padT)title:SetText("Navigation")MSUF_SkinTitle(title)sub=navParent:CreateFontString(nil,"OVERLAY","GameFontDisableSmall")sub:SetPoint("TOPLEFT",title,"BOTTOMLEFT",0,-2)sub:SetText("Quick access")MSUF_SkinMuted(sub)navParent._msufNavTitle=title navParent._msufNavSub=sub else title=navParent._msufNavTitle sub=navParent._msufNavSub end
if not navParent._msufNavHighlight then local hl=navParent:CreateTexture(nil,"BACKGROUND")hl:SetTexture(MSUF_SUPERELLIPSE_TEX)hl:SetVertexColor(1,1,1,0.06)hl:Hide()navParent._msufNavHighlight=hl local stripe=navParent:CreateTexture(nil,"BORDER")stripe:SetTexture("Interface/Buttons/WHITE8X8")stripe:SetVertexColor(0.18,0.45,1.00,0.55)stripe:SetWidth(3)stripe:Hide()navParent._msufNavStripe=stripe end
local function MakeButton(label,w,onClick,isHeader,isChild) Perfy_Trace(Perfy_GetTime(), "Enter", "MakeButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:920:6"); local b=UI_Button(navParent,tostring(label or""),w,btnH,"TOPLEFT",navParent,"TOPLEFT",0,0,onClick)MSUF_LeftJustifyButtonText(b,isChild and 10 or 12)MSUF_SkinNavButton(b,isHeader,isChild) Perfy_Trace(Perfy_GetTime(), "Leave", "MakeButton file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:920:6"); return b end
local NAV={{type="leaf",key="home",label="Dashboard"},{type="header",id="unitframes",label="Unit Frames",defaultOpen=true,children={{key="uf_player",label="Player"},{key="uf_target",label="Target"},{key="uf_targettarget",label="Target of Target"},{key="uf_focus",label="Focus"},{key="uf_boss",label="Boss Frames"},{key="uf_pet",label="Pet"},}},{type="header",id="options",label="Options",defaultOpen=true,children={{key="opt_bars",label="Bars"},{key="opt_fonts",label="Fonts"},{key="auras2",label="Auras 2.0"},{key="opt_castbar",label="Castbar"},{key="opt_misc",label="Miscellaneous"},{key="opt_colors",label="Colors"},}},{type="leaf",key="gameplay",label="Gameplay"},{type="header",id="modules",label="Modules",defaultOpen=false,children={{key="modules",label="Style"},}},{type="leaf",key="profiles",label="Profiles"},}local headerLabels={}for _,node in ipairs(NAV)do if node.type=="header"then headerLabels[node.id]=node.label end
end
local created={}for _,node in ipairs(NAV)do if node.type=="leaf"then local b=MakeButton(node.label,btnW,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:923:104"); MSUF_SwitchMirrorPage(node.key) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:923:104"); end
,false,false)out[node.key]=b table.insert(created,{kind="leaf",btn=b})elseif node.type=="header"then headers[node.id]=(headers[node.id]~=nil)and headers[node.id]or node.defaultOpen local b=MakeButton("+ "..node.label,btnW,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:924:222"); headers[node.id]=not headers[node.id]if navParent._msufTreeReflow then navParent._msufTreeReflow()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:924:222"); end
,true,false)out["hdr_"..node.id]=b table.insert(created,{kind="header",id=node.id,btn=b})local kids={}for _,ch in ipairs(node.children or{})do local w=math.max(40,btnW-indent)local cb=MakeButton(ch.label,w,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:926:206"); MSUF_SwitchMirrorPage(ch.key) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:926:206"); end
,false,true)out[ch.key]=cb table.insert(kids,cb)table.insert(created,{kind="child",id=node.id,btn=cb})end
end
end
local function Reflow() Perfy_Trace(Perfy_GetTime(), "Enter", "Reflow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:930:6"); local yOfs=-padT if hasTitle then yOfs=-(padT+26)end
local lowestBottomY=0 local function Place(btn,x) Perfy_Trace(Perfy_GetTime(), "Enter", "Place file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:931:28"); if not btn then Perfy_Trace(Perfy_GetTime(), "Leave", "Place file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:931:28"); return end
if btn.ClearAllPoints and btn.SetPoint then btn:ClearAllPoints()btn:SetPoint("TOPLEFT",navParent,"TOPLEFT",padL+(x or 0),yOfs)end
local bottomY=yOfs-btnH if bottomY<lowestBottomY then lowestBottomY=bottomY end
yOfs=yOfs-(btnH+gap) Perfy_Trace(Perfy_GetTime(), "Leave", "Place file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:931:28"); end
for _,it in ipairs(created)do if it.kind=="leaf"then if it.btn.Show then it.btn:Show()end
Place(it.btn,0)elseif it.kind=="header"then local open=headers[it.id]local baseLabel=headerLabels[it.id]if baseLabel and it.btn.SetText then it.btn:SetText((open and"- "or"+ ")..baseLabel)end
if it.btn.Show then it.btn:Show()end
Place(it.btn,0)elseif it.kind=="child"then if headers[it.id]then if it.btn.Show then it.btn:Show()end
Place(it.btn,indent)else if it.btn.Hide then it.btn:Hide()end
end
end
end
local function ApplyMinHeight() Perfy_Trace(Perfy_GetTime(), "Enter", "ApplyMinHeight file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:943:6"); local navRail=navParent and navParent.GetParent and navParent:GetParent()if not navRail then Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyMinHeight file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:943:6"); return end
local content=navRail.GetParent and navRail:GetParent()if not content then Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyMinHeight file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:943:6"); return end
local win=content.GetParent and content:GetParent()if not win then Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyMinHeight file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:943:6"); return end
local minW=820;local neededNavStackH=math.abs(lowestBottomY)+padB+14;local baseChromeH=140;local minH=math.max(520,baseChromeH+neededNavStackH)if win.SetResizeBounds then pcall(win.SetResizeBounds,win,minW,minH,2000,2000)elseif win.SetMinResize then pcall(win.SetMinResize,win,minW,minH)end
Perfy_Trace(Perfy_GetTime(), "Leave", "ApplyMinHeight file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:943:6"); end
if C_Timer and C_Timer.After then C_Timer.After(0,ApplyMinHeight)C_Timer.After(0.05,ApplyMinHeight)else ApplyMinHeight()end
Perfy_Trace(Perfy_GetTime(), "Leave", "Reflow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:930:6"); end
navParent._msufTreeReflow=Reflow Reflow() Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_BuildMirrorNavButtons file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:917:6"); return out end
local function MSUF_CreateOptionsWindow() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_CreateOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:951:6"); if S.win then return Perfy_Trace_Passthrough("Leave", "MSUF_CreateOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:951:6", S.win) end
local f=CreateFrame("Frame","MSUF_StandaloneOptionsWindow",UIParent,"BackdropTemplate")f:SetSize(900,650)f:SetPoint("CENTER",UIParent,"CENTER",-60,10)if f.SetClipsChildren then f:SetClipsChildren(false)end
f:SetFrameStrata("DIALOG")f:SetClampedToScreen(true)if f.SetClampRectInsets then f:SetClampRectInsets(8,8,8,8)end
if MSUF_RegisterEscClose then MSUF_RegisterEscClose(f)end
f:EnableMouse(true)f:SetMovable(true)f:SetResizable(true)do local minW,minH=760,560;local maxW,maxH=2200,1400 if f.SetResizeBounds then f:SetResizeBounds(minW,minH,maxW,maxH)elseif f.SetMinResize then f:SetMinResize(minW,minH)end
f._msufMinW,f._msufMinH,f._msufMaxW,f._msufMaxH=minW,minH,maxW,maxH end
f._msufGeomKey="full"if MSUF_LoadWindowGeometry then MSUF_LoadWindowGeometry(f,"full",900,650,"CENTER",-60,10)end
f:RegisterForDrag("LeftButton")f:SetScript("OnDragStart",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:958:57"); self:StartMoving() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:958:57"); end
)f:SetScript("OnDragStop",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:959:26"); self:StopMovingOrSizing()if MSUF_SaveWindowGeometry then MSUF_SaveWindowGeometry(self,self._msufGeomKey or"full")end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:959:26"); end
)MSUF_AttachManualResizeGrip(f)MSUF_ApplyMidnightBackdrop(f,1.0)local title=f:CreateFontString(nil,"OVERLAY","GameFontNormalLarge")title:SetPoint("TOPLEFT",12,-10)title:SetText("MSUF Options")MSUF_SkinTitle(title)f._msufTitleFS=title local close=UI_CloseButton(f,"TOPRIGHT",f,"TOPRIGHT",-4,-4)local function MSUF_SetPropagateKeyboardInputSafe(frame,enabled) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_SetPropagateKeyboardInputSafe file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:961:299"); if not frame or not frame.SetPropagateKeyboardInput then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetPropagateKeyboardInputSafe file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:961:299"); return end
if type(InCombatLockdown)=="function"and InCombatLockdown()then frame._msufPendingPropagateKeyboard=enabled Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetPropagateKeyboardInputSafe file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:961:299"); return end
frame._msufPendingPropagateKeyboard=nil frame:SetPropagateKeyboardInput(enabled) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_SetPropagateKeyboardInputSafe file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:961:299"); end
if not f._msufPropagateRegenFrame then local rf=CreateFrame("Frame")rf:RegisterEvent("PLAYER_REGEN_ENABLED")rf:SetScript("OnEvent",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:964:131"); if f and f._msufPendingPropagateKeyboard~=nil then if f:IsShown()then MSUF_SetPropagateKeyboardInputSafe(f,f._msufPendingPropagateKeyboard)else f._msufPendingPropagateKeyboard=nil end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:964:131"); end
)f._msufPropagateRegenFrame=rf end
local content=CreateFrame("Frame",nil,f)content:SetPoint("TOPLEFT",f,"TOPLEFT",8,-30)content:SetPoint("BOTTOMRIGHT",f,"BOTTOMRIGHT",-8,8)content:SetScale(1.0)if content.SetClipsChildren then content:SetClipsChildren(false)end
S.content=content local navRail=CreateFrame("Frame",nil,content,"BackdropTemplate")navRail:SetPoint("TOPLEFT",content,"TOPLEFT",0,0)navRail:SetPoint("BOTTOMLEFT",content,"BOTTOMLEFT",0,0)navRail:SetWidth(150)MSUF_ApplyMidnightBackdrop(navRail,0.22)f._msufNavRail=navRail local host=CreateFrame("Frame",nil,content)host:SetPoint("TOPLEFT",navRail,"TOPRIGHT",8,0)host:SetPoint("BOTTOMRIGHT",content,"BOTTOMRIGHT",0,0)host:SetScale(1.0)if host.SetClipsChildren then host:SetClipsChildren(false)end
f._msufMirrorHost=host local clip=CreateFrame("Frame",nil,host)clip:SetPoint("TOPLEFT",host,"TOPLEFT",0,0)clip:SetPoint("BOTTOMRIGHT",host,"BOTTOMRIGHT",0,0)if clip.SetClipsChildren then clip:SetClipsChildren(true)end
f._msufMirrorClipHost=clip local navStack=CreateFrame("Frame",nil,navRail)navStack._msufSkipNavTitle=true local railW=navRail.GetWidth and navRail:GetWidth()or 150 if navStack.SetWidth then navStack:SetWidth(math.max(80,railW-16))end
f._msufNavStack=navStack f._msufNavButtons=MSUF_BuildMirrorNavButtons(navStack,130,22)do local pad=8 if navStack.ClearAllPoints then navStack:ClearAllPoints()end
navStack:SetPoint("TOPLEFT",navRail,"TOPLEFT",pad,-pad)navStack:SetPoint("TOPRIGHT",navRail,"TOPRIGHT",-pad,-pad)navStack:SetPoint("BOTTOMLEFT",navRail,"BOTTOMLEFT",pad,pad)navStack:SetPoint("BOTTOMRIGHT",navRail,"BOTTOMRIGHT",-pad,pad)end
local home=CreateFrame("Frame",nil,host,"BackdropTemplate")home:SetAllPoints(host)MSUF_ApplyMidnightBackdrop(home,0.35)home:Hide()S.mirror.homePanel=home f._msufHomePanel=home MSUF_ApplyMidnightControlsToFrame(home)local homeTitle=home:CreateFontString(nil,"OVERLAY","GameFontNormalLarge")homeTitle:SetPoint("TOPLEFT",12,-10)homeTitle:SetText("Main Menu")MSUF_SkinTitle(homeTitle)local homeHint=home:CreateFontString(nil,"OVERLAY","GameFontHighlightSmall")homeHint:SetPoint("TOPLEFT",homeTitle,"BOTTOMLEFT",0,-2)homeHint:SetText("Quick tools & UI scale (same content as /msuf options).")MSUF_SkinText(homeHint)local tipBox=CreateFrame("Frame",nil,home)tipBox:SetPoint("TOPLEFT",home,"TOPLEFT",12,-44)tipBox:SetPoint("TOPRIGHT",home,"TOPRIGHT",-12,-44)tipBox:SetHeight(22)local tipLabel=tipBox:CreateFontString(nil,"OVERLAY","GameFontDisableSmall")tipLabel:SetPoint("TOPLEFT",tipBox,"TOPLEFT",0,0)tipLabel:SetJustifyH("LEFT")tipLabel:SetJustifyV("TOP")tipLabel:SetAlpha(0.82)tipLabel:SetText("Tip:")MSUF_SkinMuted(tipLabel)local tipText=tipBox:CreateFontString(nil,"OVERLAY","GameFontDisableSmall")tipText:SetPoint("TOPLEFT",tipLabel,"TOPRIGHT",6,0)tipText:SetPoint("TOPRIGHT",tipBox,"TOPRIGHT",0,0)tipText:SetJustifyH("LEFT")tipText:SetJustifyV("TOP")tipText:SetAlpha(0.82)tipText:SetText("")MSUF_SkinMuted(tipText)MSUF_ForceItalicFont(tipText)home._msufTipLabel=tipLabel home._msufTipText=tipText home:SetScript("OnShow",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:974:1422"); MSUF_UpdateHomePanel(self) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:974:1422"); end
)MSUF_ApplyFontBumpToFrame(home,MENU_FONT_BUMP)MSUF_ForceItalicFont(tipText)local statusLine=home:CreateFontString(nil,"OVERLAY","GameFontDisableSmall")statusLine:SetPoint("TOPLEFT",tipBox,"BOTTOMLEFT",0,-6)statusLine:SetPoint("TOPRIGHT",tipBox,"BOTTOMRIGHT",0,-6)statusLine:SetJustifyH("LEFT")statusLine:SetJustifyV("TOP")statusLine:SetAlpha(0.78)statusLine:SetText("")MSUF_SkinMuted(statusLine)home._msufStatusLine=statusLine local split=CreateFrame("Frame",nil,home)split:SetPoint("TOPLEFT",home,"TOPLEFT",12,-96)split:SetPoint("BOTTOMRIGHT",home,"BOTTOMRIGHT",-12,14)local colGap=14;local colL=CreateFrame("Frame",nil,split)colL:SetPoint("TOPLEFT",split,"TOPLEFT",0,0)colL:SetPoint("BOTTOMLEFT",split,"BOTTOMLEFT",0,0)colL:SetPoint("TOPRIGHT",split,"TOP",-(colGap/2),0)colL:SetPoint("BOTTOMRIGHT",split,"BOTTOM",-(colGap/2),0)local colR=CreateFrame("Frame",nil,split)colR:SetPoint("TOPLEFT",split,"TOP",(colGap/2),0)colR:SetPoint("BOTTOMLEFT",split,"BOTTOM",(colGap/2),0)colR:SetPoint("TOPRIGHT",split,"TOPRIGHT",0,0)colR:SetPoint("BOTTOMRIGHT",split,"BOTTOMRIGHT",0,0)local function CreateCard(parent,titleText,anchorTo,yOff,skipTitle) Perfy_Trace(Perfy_GetTime(), "Enter", "CreateCard file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:975:1079"); local card=CreateFrame("Frame",nil,parent,"BackdropTemplate")if anchorTo then card:SetPoint("TOPLEFT",anchorTo,"BOTTOMLEFT",0,yOff or-12)card:SetPoint("TOPRIGHT",anchorTo,"BOTTOMRIGHT",0,yOff or-12)else card:SetPoint("TOPLEFT",parent,"TOPLEFT",0,0)card:SetPoint("TOPRIGHT",parent,"TOPRIGHT",0,0)end
MSUF_ApplyMidnightBackdrop(card,0.18)if not skipTitle then local title=UI_TextTL(card,"GameFontNormal",10,-8,titleText or"",MSUF_SkinTitle)card._msufTitle=title end
Perfy_Trace(Perfy_GetTime(), "Leave", "CreateCard file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:975:1079"); return card end
local function DashToggleEditMode() Perfy_Trace(Perfy_GetTime(), "Enter", "DashToggleEditMode file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:978:6"); if type(_G.MSUF_SetMSUFEditModeDirect)=="function"then local st=_G.MSUF_EditState;local nextActive=true if st and st.active~=nil then nextActive=not st.active end
pcall(_G.MSUF_SetMSUFEditModeDirect,nextActive) Perfy_Trace(Perfy_GetTime(), "Leave", "DashToggleEditMode file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:978:6"); return end
if type(_G.MSUF_ToggleEditMode)=="function"then pcall(_G.MSUF_ToggleEditMode)elseif type(_G.MSUF_EditMode_Toggle)=="function"then pcall(_G.MSUF_EditMode_Toggle)else MSUF_Print("Edit Mode function not found.")end
Perfy_Trace(Perfy_GetTime(), "Leave", "DashToggleEditMode file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:978:6"); end
local function MSUF_ShowResetPositionsConfirm() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowResetPositionsConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:982:6"); if InCombatLockdown and InCombatLockdown()then MSUF_Print("Cannot reset while in combat.") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowResetPositionsConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:982:6"); return end
-- === Slash Commands ===

if not StaticPopupDialogs["MSUF_RESET_POS_CONFIRM"]then StaticPopupDialogs["MSUF_RESET_POS_CONFIRM"]={text="Reset MSUF frame positions now?\n\nThis resets MSUF frame positions + visibility to defaults for the ACTIVE profile.",button1=YES,button2=NO,timeout=0,whileDead=1,hideOnEscape=1,preferredIndex=3,OnAccept=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:985:312"); if _G.SlashCmdList and _G.SlashCmdList["MIDNIGHTSUF"]then pcall(_G.SlashCmdList["MIDNIGHTSUF"],"reset")else MSUF_Print("/msuf reset handler not found.")end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:985:312"); end
,}end
StaticPopup_Show("MSUF_RESET_POS_CONFIRM") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowResetPositionsConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:982:6"); end
local function MSUF_ShowFactoryResetConfirm() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowFactoryResetConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:989:6"); if InCombatLockdown and InCombatLockdown()then MSUF_Print("Cannot factory reset while in combat.") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowFactoryResetConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:989:6"); return end
if not StaticPopupDialogs["MSUF_FACTORY_RESET_CONFIRM"]then StaticPopupDialogs["MSUF_FACTORY_RESET_CONFIRM"]={text="FACTORY RESET MSUF now?\n\nThis deletes ALL MSUF profiles & settings for this account.\n\nThe UI will reload.",button1=YES,button2=NO,timeout=0,whileDead=1,hideOnEscape=1,preferredIndex=3,OnAccept=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:990:313"); if type(_G.MSUF_DoFullReset)=="function"then pcall(_G.MSUF_DoFullReset); Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:990:313"); return end
_G.MSUF_DB=nil;_G.MSUF_GlobalDB=nil _G.MSUF_ActiveProfile=nil if type(ReloadUI)=="function"then ReloadUI()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:990:313"); end
,}end
StaticPopup_Show("MSUF_FACTORY_RESET_CONFIRM") Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowFactoryResetConfirm file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:989:6"); end
local quick=CreateCard(colL,"Quick Actions")quick:SetHeight(206)local bigW=410;local bigH=26;local LQ=MSUF_LayoutColumn(quick,12,-34,bigH,8);local qx1,qy1=LQ:Row(bigH,8);local bEdit=UI_BtnTL(quick,"Toggle Edit Mode",bigW,bigH,qx1,qy1,DashToggleEditMode,"Toggle Edit Mode","Enter MSUF Edit Mode to drag frames and adjust positions.",MSUF_SkinDashboardButton)local win=_G and _G.MSUF_StandaloneOptionsWindow if win then win._msufDashEditBtn=bEdit end
if bEdit and bEdit._msufSetSelected then bEdit:_msufSetSelected(MSUF_IsMSUFEditModeActive())end
MSUF_TryHookEditModeForDashboard()local qx2,qy2=LQ:Row(bigH,10);local bReset=UI_BtnTL(quick,"Reset Frame Positions",bigW,bigH,qx2,qy2,MSUF_ShowResetPositionsConfirm,"Reset Frame Positions","Resets MSUF frame positions + visibility to defaults (active profile).",MSUF_SkinDashboardButton);local smallH=22;local qx3,qy3=LQ:Row(smallH,0);local rowBtns=MSUF_BuildButtonRowTL(quick,qx3,qy3,{{text="Colors",w=160,h=smallH,gap=10,skinFn=MSUF_SkinDashboardButton,onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:997:463"); MSUF_SwitchMirrorPage("colors") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:997:463"); end
},{text="Gameplay",w=118,h=smallH,skinFn=MSUF_SkinDashboardButton,onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:998:74"); MSUF_SwitchMirrorPage("gameplay") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:998:74"); end
},},10)local bColors=rowBtns[1];local bGameplay=rowBtns[2];local profCard=CreateCard(colL,"Profile",quick,-12)profCard:SetHeight(92)local LP=MSUF_LayoutColumn(profCard,12,-34,18,6);local px,py=LP:Row(18,0);local profLabel=UI_TextTL(profCard,"GameFontHighlight",px,py,"Active profile:",MSUF_SkinText);local profValue=UI_Text(profCard,"GameFontHighlight","LEFT",profLabel,"RIGHT",8,0,((_G and _G.MSUF_ActiveProfile)or"Default"),MSUF_SkinTitle)home._msufProfileValue=profValue local bProfiles=UI_Btn(profCard,"Open Profiles",160,22,"TOPRIGHT",profCard,"TOPRIGHT",-12,-30,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:999:568"); MSUF_SwitchMirrorPage("profiles") Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:999:568"); end
,nil,nil,MSUF_SkinDashboardButton)do local DISCORD_URL="https://discord.gg/JQnhZXnTAK";local discordRow=CreateFrame("Frame",nil,profCard)discordRow:SetPoint("TOPLEFT",profCard,"TOPLEFT",12,-56)discordRow:SetPoint("TOPRIGHT",profCard,"TOPRIGHT",-12,-56)discordRow:SetHeight(20)local discordLabel=discordRow:CreateFontString(nil,"OVERLAY","GameFontHighlight")discordLabel:SetPoint("LEFT",discordRow,"LEFT",0,0)discordLabel:SetText("Discord:")MSUF_SkinText(discordLabel)local bDiscordSelect=UI_Btn(discordRow,"Select",72,18,"RIGHT",discordRow,"RIGHT",0,0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1000:552"); if discordRow._msufDiscordBox and discordRow._msufDiscordBox.SetFocus then discordRow._msufDiscordBox:SetFocus()if discordRow._msufDiscordBox.HighlightText then discordRow._msufDiscordBox:HighlightText()end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1000:552"); end
,"Select","Click to select this text.",MSUF_SkinDashboardButton)local discordBox=CreateFrame("EditBox",nil,discordRow,"InputBoxTemplate")discordBox:SetAutoFocus(false)discordBox:SetHeight(18)discordBox:SetPoint("LEFT",discordLabel,"RIGHT",8,0)discordBox:SetPoint("RIGHT",bDiscordSelect,"LEFT",-8,0)discordBox:SetText(DISCORD_URL)discordBox:SetCursorPosition(0)if discordBox.SetTextColor then discordBox:SetTextColor(0.30,0.60,1.00)end
if discordBox.SetScript then discordBox:SetScript("OnEditFocusGained",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1004:70"); if self.HighlightText then self:HighlightText()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1004:70"); end
)discordBox:SetScript("OnEscapePressed",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1006:40"); if self.ClearFocus then self:ClearFocus()end
if self.HighlightText then self:HighlightText(0,0)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1006:40"); end
)discordBox:SetScript("OnEnterPressed",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1009:39"); if self.ClearFocus then self:ClearFocus()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1009:39"); end
)end
discordRow._msufDiscordBox=discordBox end
local adv=CreateCard(colL,"Advanced",profCard,-12)adv:SetPoint("BOTTOMLEFT",colL,"BOTTOMLEFT",0,0)adv:SetPoint("BOTTOMRIGHT",colL,"BOTTOMRIGHT",0,0)local advTitle=adv._msufTitle local advToggle=UI_Btn(adv,"Show",88,18,"TOPRIGHT",adv,"TOPRIGHT",-12,-8,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1013:251"); Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1013:251"); end
,nil,nil,MSUF_SkinDashboardButton)local advHint=adv:CreateFontString(nil,"OVERLAY","GameFontDisableSmall")advHint:SetPoint("TOPLEFT",adv,"TOPLEFT",12,-34)advHint:SetWidth(410)advHint:SetJustifyH("LEFT")advHint:SetJustifyV("TOP")advHint:SetAlpha(0.82)MSUF_SkinMuted(advHint)local advBody=CreateFrame("Frame",nil,adv)advBody:SetPoint("TOPLEFT",advHint,"BOTTOMLEFT",0,-8)advBody:SetPoint("TOPRIGHT",adv,"TOPRIGHT",-12,-58)advBody:SetPoint("BOTTOMLEFT",adv,"BOTTOMLEFT",12,12)advBody:SetPoint("BOTTOMRIGHT",adv,"BOTTOMRIGHT",-12,12)local cmds=advBody:CreateFontString(nil,"OVERLAY","GameFontHighlightSmall")cmds:SetPoint("TOPLEFT",advBody,"TOPLEFT",0,0)cmds:SetJustifyH("LEFT")cmds:SetJustifyV("TOP")cmds:SetWidth(410)cmds:SetText(MSUF_JoinLines({"/msuf  - Open MSUF menu","/msuf options  - Open Options","/msuf colors  - Open Colors","/msuf gameplay  - Open Gameplay","/msuf reset  - Reset frame positions","/msuf fullreset  - Factory reset","/msuf absorb  - Toggle absorb in HP text","/msufprofile on/off/reset/show","/msuf help  - Print help in chat",}))MSUF_SkinText(cmds)local btnRow=CreateFrame("Frame",nil,advBody)btnRow:SetPoint("BOTTOMLEFT",advBody,"BOTTOMLEFT",0,0)btnRow:SetPoint("BOTTOMRIGHT",advBody,"BOTTOMRIGHT",0,0)btnRow:SetHeight(24)do local defs={{text="Print Help",w=120,h=20,onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1014:1300"); if _G.SlashCmdList and _G.SlashCmdList["MIDNIGHTSUF"]then pcall(_G.SlashCmdList["MIDNIGHTSUF"],"help")end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1014:1300"); end
,},{text="Factory Reset",w=120,h=20,gap=8,onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1016:50"); MSUF_ShowFactoryResetConfirm() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1016:50"); end
,},}local prev for i,d in ipairs(defs)do local b if i==1 then b=UI_Btn(btnRow,d.text,d.w,d.h,"BOTTOMLEFT",btnRow,"BOTTOMLEFT",0,0,d.onClick,d.tipTitle,d.tipBody,MSUF_SkinDashboardButton)else b=UI_Btn(btnRow,d.text,d.w,d.h,"LEFT",prev,"RIGHT",d.gap or 8,0,d.onClick,d.tipTitle,d.tipBody,MSUF_SkinDashboardButton)end
prev=b end
end
local function AdvApplyState(open) Perfy_Trace(Perfy_GetTime(), "Enter", "AdvApplyState file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1020:6"); if open then advToggle:SetText("Hide")advHint:SetText("")advBody:Show()else advToggle:SetText("Show")advHint:SetText("Hidden. Click Show to reveal slash commands + power tools.")advBody:Hide()end
Perfy_Trace(Perfy_GetTime(), "Leave", "AdvApplyState file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1020:6"); end
advToggle:SetScript("OnClick",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1022:30"); S.mirror.dashAdvOpen=not S.mirror.dashAdvOpen;AdvApplyState(S.mirror.dashAdvOpen) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1022:30"); end
)AdvApplyState(S.mirror.dashAdvOpen==true)local scaleCard=CreateCard(colR,nil,nil,nil,true)scaleCard:SetHeight(238)S.mirror.homeToolsApi=MSUF_BuildTools(scaleCard,{compact=false,wide=true,xl=true,title="Scale & Layout",segmented=true,showValue=true})local presetsCard=CreateCard(colR,"Presets",scaleCard,-12)presetsCard:SetPoint("BOTTOMLEFT",colR,"BOTTOMLEFT",0,0)presetsCard:SetPoint("BOTTOMRIGHT",colR,"BOTTOMRIGHT",0,0)local presetsTitle=presetsCard._msufTitle;local presetDrop=CreateFrame("Frame","MSUF_PresetDropdown",presetsCard,"UIDropDownMenuTemplate")presetDrop:SetPoint("TOPLEFT",presetsTitle,"BOTTOMLEFT",-16,-4)UIDropDownMenu_SetWidth(presetDrop,220)UIDropDownMenu_SetText(presetDrop,presetsCard._msufSelectedPreset or"Select preset...")UIDropDownMenu_Initialize(presetDrop,function(self,level) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1023:786"); local names=MSUF_GetPresetNames()if not names or#names==0 then local info=UIDropDownMenu_CreateInfo();info.text="(no presets)"info.notCheckable=true;UIDropDownMenu_AddButton(info,level) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1023:786"); return end
for _,name in ipairs(names)do local info=UIDropDownMenu_CreateInfo();info.text=name info.checked=(presetsCard._msufSelectedPreset==name);info.func=function() Perfy_Trace(Perfy_GetTime(), "Enter", "info.func file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1024:147"); presetsCard._msufSelectedPreset=name;UIDropDownMenu_SetText(presetDrop,name) Perfy_Trace(Perfy_GetTime(), "Leave", "info.func file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1024:147"); end
UIDropDownMenu_AddButton(info,level)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1023:786"); end
)do local names=MSUF_GetPresetNames()if(not presetsCard._msufSelectedPreset)and names and names[1]then presetsCard._msufSelectedPreset=names[1]UIDropDownMenu_SetText(presetDrop,names[1])end
end
local bLoadPreset=UI_Btn(presetsCard,"Load preset",240,24,"TOPLEFT",presetDrop,"BOTTOMLEFT",16,-6,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1029:98"); local sel=presetsCard._msufSelectedPreset if not sel then MSUF_Print("Select a preset first."); Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1029:98"); return end
MSUF_ShowPresetConfirm(sel) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1029:98"); end
,"Load preset","Applies the selected preset to your current active profile. This overwrites settings (export first if unsure).",MSUF_SkinDashboardButton)local presetHint=presetsCard:CreateFontString(nil,"OVERLAY","GameFontNormalSmall")presetHint:SetPoint("TOPLEFT",bLoadPreset,"BOTTOMLEFT",0,-4)presetHint:SetText("Overwrites your current active profile settings.")MSUF_SkinMuted(presetHint)do local KO_FI_URL="https://ko-fi.com/midnightsimpleunitframes#linkModal";local PAYPAL_URL="https://www.paypal.com/ncp/payment/H3N2P87S53KBQ";local GITHUB_URL="https://github.com/Mapkov2/MidnightSimpleUnitFrames";local ICON_DIR="Interface\\AddOns\\MidnightSimpleUnitFrames\\Media\\Masks\\";local supportLabel=presetsCard:CreateFontString(nil,"OVERLAY","GameFontNormal")supportLabel:SetPoint("BOTTOMLEFT",presetsCard,"BOTTOMLEFT",12,14)supportLabel:SetText("Support the MSUF Development:")supportLabel:SetTextColor(0.90,0.90,0.90)supportLabel:SetJustifyH("LEFT")supportLabel:SetJustifyV("MIDDLE")if MSUF_SkinMuted then pcall(MSUF_SkinMuted,supportLabel)end
local row=CreateFrame("Frame",nil,presetsCard)row:SetHeight(24)row:SetWidth(120)row:SetPoint("BOTTOMRIGHT",presetsCard,"BOTTOMRIGHT",-12,12)local function CreateIcon(texFile,size,tooltipTitle,tooltipText,onClick) Perfy_Trace(Perfy_GetTime(), "Enter", "CreateIcon file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1032:146"); local b=CreateFrame("Button",nil,row)b:SetSize(size,size)local t=b:CreateTexture(nil,"ARTWORK")t:SetAllPoints()t:SetTexture(ICON_DIR..texFile)local hl=b:CreateTexture(nil,"HIGHLIGHT")hl:SetAllPoints()hl:SetColorTexture(1,1,1,0.10)b:SetScript("OnClick",onClick)if MSUF_AddTooltip then MSUF_AddTooltip(b,tooltipTitle,tooltipText)else b:SetScript("OnEnter",function(self) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1032:566"); if not GameTooltip then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1032:566"); return end
GameTooltip:SetOwner(self,"ANCHOR_TOPLEFT");GameTooltip:AddLine(tooltipTitle or"",1,1,1)if tooltipText and tooltipText~=""then GameTooltip:AddLine(tooltipText,0.85,0.85,0.85,true)end
GameTooltip:Show() Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1032:566"); end
)b:SetScript("OnLeave",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1035:23"); if GameTooltip then GameTooltip:Hide()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1035:23"); end
)end
Perfy_Trace(Perfy_GetTime(), "Leave", "CreateIcon file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1032:146"); return b end
local sz=22;local gap=7 local icons={{tex="PayPal.png",title="PayPal",tip="Click to copy the PayPal support link.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1039:123"); MSUF_ShowCopyLink("PayPal",PAYPAL_URL) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1039:123"); end
},{tex="Ko-Fi.png",title="Ko-fi",tip="Click to copy the Ko-fi link.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1040:77"); MSUF_ShowCopyLink("Ko-fi",KO_FI_URL) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1040:77"); end
},{tex="GitHub.png",title="GitHub",tip="Click to copy the GitHub repository link.",onClick=function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1041:91"); MSUF_ShowCopyLink("GitHub",GITHUB_URL) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1041:91"); end
},}local prev for _,d in ipairs(icons)do local b=CreateIcon(d.tex,sz,d.title,d.tip,d.onClick)if not prev then b:SetPoint("RIGHT",row,"RIGHT",0,0)else b:SetPoint("RIGHT",prev,"LEFT",-gap,0)end
prev=b end
end
local function MSUF_DashboardLayout() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_DashboardLayout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1045:6"); local wL=(colL and colL.GetWidth and colL:GetWidth())or 0;local wR=(colR and colR.GetWidth and colR:GetWidth())or 0 if wL<=0 or wR<=0 then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_DashboardLayout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1045:6"); return end
local innerL=math.floor(wL-24);local innerR=math.floor(wR-24)if innerL<1 then innerL=1 end
if innerR<1 then innerR=1 end
if bEdit and bEdit.SetWidth then bEdit:SetWidth(innerL)end
if bReset and bReset.SetWidth then bReset:SetWidth(innerL)end
local gap=7;local each=math.floor((innerL-(gap*2))/3)if each<1 then each=1 end
if bOptions and bOptions.SetWidth then bOptions:SetWidth(each)end
if bColors and bColors.SetWidth then bColors:SetWidth(each)end
if bGameplay and bGameplay.SetWidth then bGameplay:SetWidth(each)end
if advHint and advHint.SetWidth then advHint:SetWidth(innerL)end
if cmds and cmds.SetWidth then cmds:SetWidth(innerL)end
local ddW=math.floor(innerR-18)if ddW>320 then ddW=320 end
if ddW<1 then ddW=1 end
if presetDrop and UIDropDownMenu_SetWidth then UIDropDownMenu_SetWidth(presetDrop,ddW)end
if bLoadPreset and bLoadPreset.SetWidth then bLoadPreset:SetWidth(math.max(1,math.min(innerR,ddW+20)))end
if presetHint and presetHint.SetWidth then presetHint:SetWidth(innerR)end
if S and S.mirror and S.mirror.homeToolsApi and S.mirror.homeToolsApi.Layout then pcall(S.mirror.homeToolsApi.Layout)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_DashboardLayout file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1045:6"); end
if not home.__MSUF_DashboardLayoutHooked then home.__MSUF_DashboardLayoutHooked=true if home.HookScript then home:HookScript("OnShow",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1063:134"); if C_Timer and C_Timer.After then C_Timer.After(0,MSUF_DashboardLayout)else MSUF_DashboardLayout()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1063:134"); end
)home:HookScript("OnSizeChanged",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1065:33"); if C_Timer and C_Timer.After then C_Timer.After(0,MSUF_DashboardLayout)else MSUF_DashboardLayout()end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1065:33"); end
)end
end
if C_Timer and C_Timer.After then C_Timer.After(0,MSUF_DashboardLayout)else MSUF_DashboardLayout()end
local tint=f:CreateTexture(nil,"BORDER")tint:SetColorTexture(0.06,0.12,0.25,0.16)tint:SetPoint("TOPLEFT",host,"TOPLEFT",0,0)tint:SetPoint("BOTTOMRIGHT",host,"BOTTOMRIGHT",0,0)f._msufTint=tint f:SetScript("OnShow",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1070:213"); S.mirror.host=f._msufMirrorClipHost or f._msufMirrorHost or content do local nav=f._msufNavRail if nav and nav._msufTreeHeaders then nav._msufTreeHeaders.unitframes=true;nav._msufTreeHeaders.options=true if nav._msufTreeReflow then nav._msufTreeReflow()end
end
end
if MSUF_PickSessionTip then MSUF_PickSessionTip()end
local startKey=f._msufInitialKey or"home";local startSubKey=f._msufInitialSubKey;f._msufInitialKey=nil f._msufInitialSubKey=nil;S.mirror.currentKey=startKey MSUF_SwitchMirrorPage(startKey,startSubKey) Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1070:213"); end
)f:SetScript("OnHide",function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1075:22"); MSUF_Standalone_SetCastbarTopButtonsHidden(false)if MSUF_SaveWindowGeometry then MSUF_SaveWindowGeometry(f,f._msufGeomKey or"full")end
if S.mirror.currentPanel then MSUF_DetachMirroredPanel(S.mirror.currentPanel);S.mirror.currentPanel=nil end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1075:22"); end
)f:Hide()S.win=f Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_CreateOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:951:6"); return f end
local function MSUF_ToggleOptionsWindow(key,subkey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ToggleOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1079:6"); local w=MSUF_CreateOptionsWindow()if w:IsShown()then if key and S.mirror.currentKey~=key then MSUF_SwitchMirrorPage(key,subkey) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ToggleOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1079:6"); return end
if subkey then MSUF_SwitchMirrorPage(key or S.mirror.currentKey or"home",subkey) Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ToggleOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1079:6"); return end
w:Hide() Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ToggleOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1079:6"); return end
w._msufInitialKey=key w._msufInitialSubKey=subkey or"home"w._msufInitialSubKey=subkey w:Show() Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ToggleOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1079:6"); end
local function MSUF_ShowOptionsWindow(key,subkey) Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_ShowOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1083:6"); local w=MSUF_CreateOptionsWindow()key=key or"home"if w.IsShown and w:IsShown()then if key and S and S.mirror and S.mirror.currentKey~=key then MSUF_SwitchMirrorPage(key,subkey)elseif key then MSUF_SwitchMirrorPage(key,subkey)end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1083:6"); return w end
w._msufInitialKey=key w._msufInitialSubKey=subkey if w.Show then w:Show()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_ShowOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1083:6"); return w end
local function MSUF_HideOptionsWindow() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_HideOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1087:6"); if S and S.win and S.win.IsShown and S.win:IsShown()and S.win.Hide then S.win:Hide()end
Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_HideOptionsWindow file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1087:6"); end
_G.MSUF_ShowStandaloneOptionsWindow=MSUF_ShowOptionsWindow _G.MSUF_OpenStandaloneOptionsWindow=MSUF_ShowOptionsWindow _G.MSUF_HideStandaloneOptionsWindow=MSUF_HideOptionsWindow _G.MSUF_OpenPage=function(key,subkey) Perfy_Trace(Perfy_GetTime(), "Enter", "_G.MSUF_OpenPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1089:194"); key=(key or"home")if type(key)=="string"then key=key:lower()else key="home"end
if key=="menu"or key=="flash"then key="home"elseif key=="options"then key="main"elseif key=="unit"or key=="frames"then key="main"elseif key=="boss_castbar"or key=="bosscastbar"then key="castbar"subkey=subkey or"boss"end
if key=="player"or key=="target"or key=="focus"or key=="targettarget"or key=="pet"or key=="boss"then subkey=key key="main"end
if key=="bars"or key=="fonts"or key=="auras"or key=="misc"or key=="profiles"then subkey=key key="main"end
if MSUF_IsCastbarKey(key)and(subkey==nil or subkey==true)then end
local info=(type(MSUF_GetMirrorPageInfo)=="function")and MSUF_GetMirrorPageInfo(key)or nil if info then local panel if type(info.build)=="function"then panel=info.build()end
if(key~="home")and(type(info.build)=="function")and(not panel)then MSUF_ShowOptionsWindow("home") Perfy_Trace(Perfy_GetTime(), "Leave", "_G.MSUF_OpenPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1089:194"); return false end
MSUF_ShowOptionsWindow(key,subkey) Perfy_Trace(Perfy_GetTime(), "Leave", "_G.MSUF_OpenPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1089:194"); return true end
MSUF_ShowOptionsWindow("home") Perfy_Trace(Perfy_GetTime(), "Leave", "_G.MSUF_OpenPage file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1089:194"); return false end
_G.MSUF_OpenOptionsMenu=function() Perfy_Trace(Perfy_GetTime(), "Enter", "_G.MSUF_OpenOptionsMenu file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1098:24"); if _G and _G.MSUF_OpenPage then _G.MSUF_OpenPage("home")else MSUF_ShowOptionsWindow("home")end
Perfy_Trace(Perfy_GetTime(), "Leave", "_G.MSUF_OpenOptionsMenu file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1098:24"); end
local function MSUF_InstallSlashHook() Perfy_Trace(Perfy_GetTime(), "Enter", "MSUF_InstallSlashHook file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1100:6"); if _G.MSUF_SlashHooked then Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_InstallSlashHook file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1100:6"); return end
if SlashCmdList and SlashCmdList["MIDNIGHTSUF"]then local original=SlashCmdList["MIDNIGHTSUF"]SlashCmdList["MIDNIGHTSUF"]=function(msg) Perfy_Trace(Perfy_GetTime(), "Enter", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); local raw=msg or""raw=raw:gsub("^%s+","")local first,rest=raw:match("^(%S+)%s*(.-)%s*$")first=first and first:lower()or""rest=rest or""local function openKey(key) Perfy_Trace(Perfy_GetTime(), "Enter", "openKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:276"); MSUF_ToggleOptionsWindow(key) Perfy_Trace(Perfy_GetTime(), "Leave", "openKey file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:276"); end
if first==""then openKey("home") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
if first=="menu"or first=="home"then openKey("home") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
if first=="options"then openKey("main") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
if first=="colors"or first=="colours"then openKey("colors") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
if first=="gameplay"then openKey("gameplay") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
if first=="castbar"then local sub=rest and rest:lower()or""if sub~=""then MSUF_ToggleOptionsWindow("castbar",sub)else openKey("castbar")end
Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
if first=="profiles"then openKey("profiles") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122"); return end
return Perfy_Trace_Passthrough("Leave", "SlashCmdList.MIDNIGHTSUF file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1101:122", original(msg)) end
end
SLASH_MSUFOPTIONS1="/msufoptions"SlashCmdList["MSUFOPTIONS"]=function() Perfy_Trace(Perfy_GetTime(), "Enter", "SlashCmdList.MSUFOPTIONS file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1112:61"); MSUF_ToggleOptionsWindow("main") Perfy_Trace(Perfy_GetTime(), "Leave", "SlashCmdList.MSUFOPTIONS file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1112:61"); end
_G.MSUF_SlashHooked=true Perfy_Trace(Perfy_GetTime(), "Leave", "MSUF_InstallSlashHook file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1100:6"); end
MSUF_InstallSlashHook()local scaleEvent=CreateFrame("Frame")scaleEvent:RegisterEvent("PLAYER_LOGIN")scaleEvent:RegisterEvent("PLAYER_ENTERING_WORLD")scaleEvent:RegisterEvent("DISPLAY_SIZE_CHANGED")scaleEvent:SetScript("OnEvent",function(_,event,arg1) Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1114:228"); if MSUF_IsScalingDisabled and MSUF_IsScalingDisabled()then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1114:228"); return end
MSUF_ApplyMsufScale(MSUF_GetSavedMsufScale());local want=MSUF_GetDesiredGlobalScaleFromDB()if want then if event=="PLAYER_LOGIN"then MSUF_SetGlobalUiScale(want,true);MSUF_EnsureGlobalUiScaleApplied(true)else MSUF_EnsureGlobalUiScaleApplied(true)end
end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1114:228"); end
)if C_Timer and C_Timer.After then C_Timer.After(0,function() Perfy_Trace(Perfy_GetTime(), "Enter", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1118:51"); if MSUF_IsScalingDisabled and MSUF_IsScalingDisabled()then Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1118:51"); return end
MSUF_ApplyMsufScale(MSUF_GetSavedMsufScale());local want=MSUF_GetDesiredGlobalScaleFromDB()if want then MSUF_SetGlobalUiScale(want,true,{applyCVars=false});MSUF_EnsureGlobalUiScaleApplied(true)end
Perfy_Trace(Perfy_GetTime(), "Leave", "(anonymous) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua:1118:51"); end
)end

Perfy_Trace(Perfy_GetTime(), "Leave", "(main chunk) file://E:\\World of Warcraft\\_beta_\\Interface\\AddOns\\MidnightSimpleUnitFrames\\MidnightSimpleUnitFrames_SlashMenu.lua");